# NodeJs é€Ÿé€š

å‰è¨€ï¼šå‚è€ƒ[Node.js ä¸­æ–‡ç½‘](https://nodejs.cn/en)ï¼Œå¯ä»¥é€šè¿‡[Node.Js V19 API æ–‡æ¡£](https://nodejs.org/api/documentation.html)æŸ¥çœ‹å¸¸ç”¨ API ã€‚

ç•ªå¤–

ç•ªå¤–çŸ¥è¯†ç‚¹ï¼Œå¤šå­¦ç‚¹æ€»æ²¡åå¤„ ğŸ˜€ğŸ˜€ğŸ˜€ã€‚

1. è®¡ç®—æœºçš„åŸºæœ¬ç»„æˆ

è®¡ç®—æœºç”± CUPã€å†…å­˜ã€ç¡¬ç›˜ã€æ˜¾å¡ã€ä¸»æ¿ã€æ•£çƒ­å™¨ç­‰ç»„æˆã€‚

1.1 CUP

ä¸­å¤®å¤„ç†å™¨ï¼Œæ˜¯æ•´ä¸ªè®¡ç®—æœºè¿ç®—å’Œæ§åˆ¶çš„ä¸­å¿ƒ

1.2 å†…å­˜

æ˜¯å­˜å‚¨æ•°æ®çš„ä»‹è´¨ï¼Œè¯»å†™é€Ÿåº¦å¿«ï¼Œä½†æ˜¯æ–­ç”µä¸¢å¤±æ•°æ®ã€‚æˆ‘ä»¬ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå°±ä¼šè½½å…¥å†…å­˜å½“ä¸­ï¼Œè®© CUP é«˜é€Ÿè¿è¡Œç¨‹åºã€‚

1.3 ç¡¬ç›˜

å’Œå†…å­˜å¾ˆåƒï¼Œç”¨äºå­˜æ”¾æ•°æ®ï¼Œè¯»å†™é€Ÿåº¦æ…¢ï¼Œæ–­ç”µä¸ä¸¢å¤±æ•°æ®ã€‚æˆ‘ä»¬å®‰è£…çš„åº”ç”¨ç¨‹åºå°±è£…åœ¨ç¡¬ç›˜ä¸­ï¼Œæ¯”å¦‚ QQã€å¾®ä¿¡ç­‰

1.4 æ˜¾å¡

å¤„ç†è§†é¢‘ä¿¡å·çš„ï¼Œå½“æœ‰ä¿¡æ¯éœ€è¦åœ¨æ˜¾ç¤ºå™¨å‘ˆç°æ—¶ï¼Œå°±è¦ä¼ é€’ç»™æ˜¾å¡ï¼Œæ˜¾å¡å¤„ç†å®Œæ¯•åï¼Œå†ä¼ è¾“ç»™æ˜¾ç¤ºå™¨ã€‚

1.5 ä¸»æ¿

é›†æˆç”µè·¯æ¿ï¼Œä¸Šé¢æœ‰å¾ˆå¤šæ’æ§½ï¼Œå¯ä»¥æ’å…¥ CUP å¤„ç†å™¨ï¼Œå†…å­˜æ¡ã€ç¡¬ç›˜ã€æ˜¾å¡ç­‰ã€‚

2. ç¨‹åºè¿è¡ŒåŸºæœ¬æµç¨‹

å®‰è£…çš„ç¨‹åºåœ¨ç¡¬ç›˜ï¼Œè¿è¡Œç¨‹åºåœ¨å†…å­˜ï¼ŒCUP ä»å†…å­˜ä¸­æ‹¿ç¨‹åºæ‰§è¡Œï¼Œæ‰§è¡Œæ—¶æœ‰è§†é¢‘ä¿¡å·ä¼ ç»™æ˜¾å¡ï¼Œæœ‰å£°éŸ³ä¿¡å·ä¼ ç»™å£°å¡ã€‚

3. è¿›ç¨‹å’Œçº¿ç¨‹

3.1 è¿›ç¨‹

è¿è¡Œä¸­çš„ç¨‹åºï¼Œæ¯ä¸€ä¸ªè¿è¡Œä¸­çš„ç¨‹åºéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹å ç”¨å†…å­˜ç©ºé—´ã€‚

3.2 çº¿ç¨‹

è¿›ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç„¶ä½ å¼€äº†ä¸€ä¸ªç¨‹åºï¼Œä½†æ˜¯è¿™ä¸ªç¨‹åºä»€ä¹ˆéƒ½ä¸åšï¼Œé‚£å®ƒå°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ã€‚ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªä»»åŠ¡ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¤šçº¿ç¨‹ã€‚

4. HTTP åè®®

è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯äº’è”ç½‘è¿ç”¨æœ€å¹¿æ³›çš„åè®®ä¹‹ä¸€ã€‚åè®®æ˜¯ä»€ä¹ˆï¼Ÿåè®®å°±æ˜¯åŒæ–¹å¿…é¡»éµä»çš„ä¸€ç»„çº¦å®šã€‚HTTP åè®®æ˜¯å¯¹æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ–¹çš„çº¦å®šã€‚

4.1 è¯·æ±‚æŠ¥æ–‡

è¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“æ„æˆã€‚ä»¥è®¿é—®ç™¾åº¦ä¸ºä¾‹ã€‚

4.1.1 è¯·æ±‚è¡Œ

ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šè¯·æ±‚æ–¹æ³•ã€URLã€HTTP åè®®ç‰ˆæœ¬å·ã€‚

è¯·æ±‚æ–¹æ³•ï¼šGET è·å–æ•°æ®ã€POST æ–°å¢æ•°æ®ã€PUT/PATCH ä¿®æ”¹æ•°æ®ã€DELETE åˆ é™¤æ•°æ®

URLï¼šç”¨æ¥å®šä½æœåŠ¡å™¨èµ„æºï¼Œç”±åè®®ã€åŸŸåã€ç«¯å£ã€è·¯å¾„ã€æŸ¥è¯¢å­—ç¬¦ä¸²ç»„æˆ

HTTP ç‰ˆæœ¬å·ï¼šæœ‰ 1.0ã€1.1ã€2ã€3 å››ä¸ªç‰ˆæœ¬å·

```js
GET https://www.baidu/com/ HTTP/1.1
```

4.1.2 è¯·æ±‚å¤´

ç”±ä¸€ç³»åˆ—çš„é”®å€¼å¯¹ç»„æˆï¼Œç”¨æ¥è®°å½•æµè§ˆå™¨çš„ç›¸å¯¹ä¿¡æ¯å’Œäº¤äº’è¡Œä¸ºç­‰ã€‚

```js
HTTP/1.1 200 OK
Bdpagetype: 1
Bdqid: 0x9a760cca0000e1ee
Connection: keep-alive
Content-Encoding: gzip
Content-Type: text/html; charset=utf-8
Date: Fri, 21 Jun 2024 03:44:22 GMT
Server: BWS/1.1
Set-Cookie: H_PS_PSSID=60297_60338_60352_60346_60364_60360; path=/; expires=Sat, 21-Jun-25 03:44:22 GMT; domain=.baidu.com
Set-Cookie: BDSVRTM=8; path=/
Set-Cookie: BD_HOME=1; path=/
Strict-Transport-Security: max-age=172800
Traceid: 1718941462054085735411130097590815744494
X-Ua-Compatible: IE=Edge,chrome=1
X-Xss-Protection: 1;mode=block
Transfer-Encoding: chunked
```

4.1.3 è¯·æ±‚ä½“

è¯·æ±‚ä½“çš„æ„æˆå°±å¾ˆçµæ´»ï¼Œæˆ‘ä»¬ç”¨çš„æœ€å¤šçš„ JSON æ ¼å¼ã€‚

4.2 å“åº”æŠ¥æ–‡

å“åº”æŠ¥æ–‡ç”±å“åº”è¡Œã€å“åº”å¤´ã€å“åº”ä½“æ„æˆã€‚ä»¥è®¿é—®ç™¾åº¦ä¸ºä¾‹ã€‚

4.2.1 å“åº”è¡Œ

ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šHTTP ç‰ˆæœ¬å·ã€å“åº”çŠ¶æ€ç ã€å“åº”çŠ¶æ€æè¿°ã€‚

HTTP ç‰ˆæœ¬å·ï¼šæœ‰ 1.0ã€1.1ã€2ã€3 å››ä¸ªç‰ˆæœ¬å·

å“åº”çŠ¶æ€ç ï¼š200 è¯·æ±‚æˆåŠŸã€403 ç¦æ­¢è¯·æ±‚ã€404 æ‰¾ä¸åˆ°èµ„æºã€500 æœåŠ¡ç«¯é”™è¯¯ã€‚

å“åº”çŠ¶æ€ç äº”å¤§ç±»ï¼š1xx ä¿¡æ¯å“åº”ã€2xx æˆåŠŸå“åº”ã€3xx é‡å®šå‘ä¿¡æ¯ã€4xx å®¢æˆ·ç«¯é”™è¯¯ã€5xx æœåŠ¡ç«¯é”™è¯¯

å“åº”çŠ¶æ€æè¿°ï¼š200 OKã€403 Forbiddenã€404 Not Foundã€500 Internal Server Error

```js
HTTP/1.1 200 OK
```

4.2.2 å“åº”å¤´

è®°å½•æœåŠ¡å™¨ç›¸å…³çš„å†…å®¹ã€‚

4.2.3 å“åº”ä½“

å“åº”ä½“å†…å®¹æ ¼å¼å¾ˆçµæ´»ï¼šHTMLã€CSSã€JSã€å›¾ç‰‡ã€è§†é¢‘ã€JSON

5. ç½‘ç»œåŸºç¡€æ¦‚å¿µ

5.1 ä»€ä¹ˆæ˜¯ IP

å°±æ˜¯ä½ ä¸Šç½‘è®¾å¤‡åœ¨äº’è”ç½‘ä¸Šçš„åœ°å€ã€‚æ¯”å¦‚ï¼š192.168.1.1

5.2 IP æœ‰ä»€ä¹ˆç”¨

IP ç”¨æ¥æ ‡è¯†ç½‘ç»œä¸­çš„è®¾å¤‡ï¼Œå®ç°è®¾å¤‡é€šä¿¡ã€‚åªè¦è®¾å¤‡æ¥å…¥äº’è”ç½‘ï¼Œå°±éƒ½ä¼šæœ‰ä¸€ä¸ª IP åœ°å€ã€‚å½“ä½ ç»™ä½ å°ä¼™ä¼´å‘æ¶ˆæ¯æ—¶ï¼Œä½ å‘çš„æ¶ˆæ¯å°±å¸¦æœ‰ä½ çš„ IP åœ°å€å’Œä½ å°ä¼™ä¼´çš„ IP åœ°å€ï¼Œè¿™æ ·æ‰èƒ½å®ç°é€šä¿¡ã€‚

5.3 IP åˆ†ç±»

æ¯ä¸€ä¸ªæ¥å…¥äº’è”ç½‘çš„è®¾å¤‡éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ IP åœ°å€ï¼Œè€Œäº’è”ç½‘ä¸Šçš„ IP æ€»å…±ä¹Ÿæ‰ 42 äº¿ï¼Œå…¨çƒäººå£ 80 äº¿+ï¼Œæ¯ä¸ªäººçš„è”ç½‘è®¾å¤‡è¿˜ä¸æ­¢ä¸€ä¸ªã€‚æœ‰æ‰‹æœºï¼Œç”µè„‘ï¼Œæ‰‹è¡¨ï¼Œç”µè§†ï¼Œæ™ºèƒ½å®¶å±…ç­‰ï¼Œè¿™ä¹ˆå¤šè®¾å¤‡æ ¹æœ¬ä¸å¤Ÿåˆ†ã€‚æ‰€ä»¥å°±æœ‰äº†å…±äº« IPï¼Œåˆ†ä¸ºåŒºåŸŸå…±äº« IP æˆ–è€…å®¶åº­å…±äº« IPã€‚æ¯”å¦‚ä½ å®¶é‡Œæœ‰æ‰‹æœºã€ç¬”è®°æœ¬ã€ç”µè§†ï¼Œç„¶åè¿™äº›è®¾å¤‡é€šè¿‡ wifi æˆ–è€…ç½‘çº¿éƒ½è¿æ¥åˆ°äº†è·¯ç”±å™¨ä¸Šï¼Œè·¯ç”±å™¨ä¼šä¸ºæ¯ä¸ªè®¾å¤‡åˆ†é… IP åœ°å€ï¼Œè·¯ç”±å™¨æœ¬èº«ä¹Ÿæœ‰ IP åœ°å€æ¯”å¦‚ 192.168.1.1ï¼Œç»™ä½ æ‰‹æœºåˆ†ä¸ª IP 192.168.1.2ï¼Œç”µè„‘ 192.168.1.3ï¼Œç”µè§† 192.168.1.4ã€‚æˆ‘ä»¬çš„è®¾å¤‡é€šè¿‡è·¯ç”±å™¨è¿æ¥åˆ°äº†ä¸€èµ·ï¼Œå½¢æˆäº†ä¸ªç½‘ç»œï¼Œè¿™æˆ‘ä»¬ç§°ä¹‹ä¸ºå±€åŸŸç½‘ã€‚è·¯ç”±å™¨åˆ†é…ç»™æˆ‘ä»¬çš„ IP åœ°å€ï¼Œç§°ä¸ºå±€åŸŸç½‘ IPã€‚åœ¨è¿™ä¸ªç½‘ç»œé‡Œï¼Œæˆ‘ä»¬çš„è®¾å¤‡æ˜¯å¯ä»¥é€šä¿¡çš„ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³ç»™ä½ è¿œæ–¹çš„å¥³å‹å‘ä¸ªæ¶ˆæ¯ â€œåƒäº†å—â€ï¼Œç›®å‰çš„ç½‘ç»œæ˜¯ä¸è¡Œçš„ã€‚éœ€è¦å°†è·¯ç”±å™¨æ¥å…¥äº’è”ç½‘ã€‚å¦‚ä½•æ¥å…¥äº’è”ç½‘å‘¢ï¼Œå»æ‰¾ç”µä¿¡ã€è”é€šã€ç§»åŠ¨åŠç†ä¸šåŠ¡ã€‚åŠç†å®Œä¸šåŠ¡åè·¯ç”±å™¨å°±æœ‰äº†å¦å¤–ä¸€ä¸ª IPï¼Œæ¯”å¦‚ 180.91.213.151ï¼Œè¿™å°±æ˜¯å…¬ç½‘ IPã€‚å®¶é‡Œè®¾å¤‡å…±äº«çš„ IP å°±æ˜¯è¿™ä¸ªå…¬ç½‘ IPï¼Œæœ‰äº†è¿™ä¸ª IPï¼Œä½ å°±å¯ä»¥å’Œè¿œæ–¹çš„å¥³å‹é€šä¿¡äº†ã€‚

å±€åŸŸç½‘ IPï¼š192.168.0.0 ~ 192.168.255.255ã€172.16.0.0 ~ 172.31.255.255ã€10.0.0.0 ~ 10.255.255.255

å…¬ç½‘ IPï¼šé™¤äº†å±€åŸŸç½‘ IP å’Œæœ¬åœ°å›ç¯ IP

æœ¬åœ°å›ç¯ IPï¼š127.0.0.1 ~ 127.255.255.254 è¿™ç±» IP åœ°å€æ˜¯æŒ‡å‘æœ¬æœºçš„ã€‚ç§°ä¸ºæœ¬åœ°å›ç¯åœ°å€ã€‚

5.4 ä»€ä¹ˆæ˜¯ç«¯å£

åº”ç”¨ç¨‹åºçš„æ•°å­—æ ‡è¯†ï¼Œä¸€å°è®¡ç®—æœºæœ‰ 65536 ä¸ªç«¯å£ï¼ˆ0 ~ 65535ï¼‰ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ã€‚ä»€ä¹ˆæ˜¯åº”ç”¨ç¨‹åºï¼Ÿå°±æ˜¯ä½ å®‰è£…åˆ°è®¡ç®—æœºä¸Šçš„è½¯ä»¶ï¼Œæ¯”å¦‚å¾®ä¿¡ã€QQã€æ¸¸æˆç­‰ã€‚

5.5 ç«¯å£æœ‰ä»€ä¹ˆç”¨

å®ç°ä¸åŒä¸»æœºåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡çš„ã€‚æ¯”å¦‚ä¸¤å°è®¡ç®—æœºçš„å¾®ä¿¡ç›¸äº’é€šä¿¡ï¼Œå¦‚æœåªæœ‰ IP æ²¡æœ‰ç«¯å£ï¼Œé‚£è®¡ç®—æœºä¸çŸ¥é“æ¥å—åˆ°çš„æŠ¥æ–‡ï¼Œç”¨ä»€ä¹ˆç¨‹åºå»å¤„ç†ã€‚

ä¸€ã€å…¥é—¨æŒ‡å—

1. Node.js ç®€ä»‹

1.1 ä»€ä¹ˆæ˜¯ Node.js

Node.js æ˜¯ä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªè¿è¡Œç¯å¢ƒæ˜¯åŸºäºè°·æ­Œ v8 å¼•æ“çš„ï¼Œç”¨äºåœ¨æœåŠ¡ç«¯è¿è¡Œ JS ä»£ç ã€‚

Node.js é‡‡ç”¨äº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼ I/O çš„è®¾è®¡ç†å¿µï¼Œä½¿ JS èƒ½é«˜æ•ˆåœ°å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ã€‚

1.2 Node.js å¯ä»¥åšä»€ä¹ˆ

å¼€å‘æœåŠ¡å™¨åº”ç”¨ã€å·¥å…·ç±»åº”ç”¨ã€æ¡Œé¢ç«¯åº”ç”¨ã€‚

1.2.1 æœåŠ¡å™¨åº”ç”¨

å¯ä»¥å¯¹ç”¨æˆ·è¯·æ±‚åšå‡ºå¤„ç†ï¼Œè¿”å›èµ„æºã€‚

1.2.2 å·¥å…·ç±»åº”ç”¨

Webpackã€Viteã€Babel

1.2.3 æ¡Œé¢ç«¯åº”ç”¨

VsCodeã€PostManã€Figma éƒ½æ˜¯ä½¿ç”¨ electron å¼€å‘çš„ï¼Œelectron æ˜¯åŸºäº node å¼€å‘çš„

1.3 Node.js çš„ä¼˜ã€ç¼ºç‚¹

ä¼˜ç‚¹ï¼šå› ä¸º Node.js é‡‡ç”¨äº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼ I/O çš„è®¾è®¡ç†å¿µï¼Œæ‰€ä»¥ä½¿ JS èƒ½é«˜æ•ˆåœ°å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ã€‚

ç¼ºç‚¹ï¼šå¤§å‰ç«¯ï¼Œæœ¨æœ‰ç¼ºç‚¹ï¼

1.4 ç¤ºä¾‹

ä½¿ç”¨ Node.js å¯åŠ¨ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª server.jsï¼Œå¹¶åœ¨ server.js æ‰€åœ¨æ–‡ä»¶å¤¹ç‚¹å³é”®æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ node server.js å‘½ä»¤ã€‚

```js
// server.js
const http = require("http");

const hostname = "127.0.0.1";
const port = 3000;

const server = http.createServer((req, res) => {
  res.statusCode = 200;
  res.setHeader("Content-Type", "text/plain");
  res.end("Hello World\n");
});

server.listen(port, hostname, () => {
  console.log(`Server running at http://${hostname}:${port}/`);
});
```

<!-- 1 -->
<!-- 2 -->

2. å¦‚ä½•å®‰è£… Node.js

[ç‚¹å‡»å®‰è£… nodejs](https://nodejs.p2hp.com/download/)ï¼Œæ¨èä½¿ç”¨ nvmï¼Œå› ä¸º nvm æ˜¯ nodejs çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œä¾¿äºåˆ‡æ¢ node ç‰ˆæœ¬ï¼Œæ•™ç¨‹[nvm ç”¨æ³•](https://blog.csdn.net/weixin_64684095/article/details/134266961)

3. Node.js å’Œæµè§ˆå™¨çš„åŒºåˆ«

å¯æ“ä½œçš„ API ä¸åŒï¼šæµè§ˆå™¨å¯ä»¥æ“ä½œ DOMã€BOMã€‚Node.js ä¸è¡Œï¼Œå› ä¸ºä¸å­˜åœ¨è¿™äº›ï¼ŒNode.js æœ‰ fsã€pathã€http ç­‰æ¨¡å—å¯ä»¥æ“ä½œï¼Œæµè§ˆå™¨æ²¡æœ‰ã€‚

æ¨¡å—ç³»ç»Ÿä¸åŒï¼šæµè§ˆå™¨åªæ”¯æŒ ES æ¨¡å—ç³»ç»Ÿï¼ŒNode.js åŒæ—¶æ”¯æŒ CommonJs å’Œ ES æ¨¡å—ç³»ç»Ÿ

äºŒã€npm åŒ…ç®¡ç†

å¯ä»¥å‚è€ƒ [npm åŒ…ç®¡ç†](https://blog.csdn.net/weixin_64684095/article/details/134256819?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171913903616800185864591%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=171913903616800185864591&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-134256819-null-null.nonecase&utm_term=%E5%8C%85&spm=1018.2226.3001.4450) å’Œ
[nvm ç”¨æ³•](https://blog.csdn.net/weixin_64684095/article/details/134266961)

1. npm ç®€ä»‹

npm æ˜¯ Node.js çš„æ ‡å‡†åŒ…ç®¡ç†å™¨ã€‚æˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨ yarn æˆ– pnpm æ¥ä»£æ›¿ npmã€‚å› ä¸ºå¯ä»¥æ›´å¿«å®‰è£…ä¾èµ–ã€‚

2. åŒ…

å°±æ˜¯é€šè¿‡ npm ä¸‹è½½åˆ°é¡¹ç›®ä¸­çš„ä¾èµ–ç»Ÿç§°ä¸ºåŒ…ï¼Œnpm ç®¡ç†é¡¹ç›®ä¾èµ–çš„ä¸‹è½½ã€‚

3. å®‰è£…ä¾èµ–

å¦‚æœé¡¹ç›®æœ‰ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œé€šè¿‡è¿è¡Œ npm install æ¥å®‰è£…ä¾èµ–ã€‚å®ƒä¼šå°†æ‰€éœ€ä¾èµ–å®‰è£…åˆ° node_modules æ–‡ä»¶å¤¹ï¼Œå¦‚æœå°šä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒã€‚

```bash
npm install
# or
yarn install
# or
pnpm install
```

4. å®‰è£…å•ä¸ªåŒ…

å¯ä»¥é€šè¿‡åŒ…åæ¥å®‰è£…ç‰¹å®šçš„åŒ…ã€‚

```bash
npm install <package-name>
// or
yarn add <package-name>
# or
pnpm add <package-name>
```

5. æ›´æ–°è½¯ä»¶åŒ…

npm å°†æ£€æŸ¥æ‰€æœ‰è½¯ä»¶åŒ…æ˜¯å¦æœ‰æ»¡è¶³ç‰ˆæœ¬æ§åˆ¶çº¦æŸçš„è¾ƒæ–°ç‰ˆæœ¬ã€‚

```bash
npm update
# or
yarn update
# or
pnpm update
```

6. æ›´æ–°å•ä¸ªåŒ…

```bash
npm update <package-name>
# or
yarn update <package-name>
# or
pnpm update <package-name>
```

7. æŒ‡å®šå®‰è£…å›ºå®šç‰ˆæœ¬åŒ…

æŒ‡å®šç‰ˆæœ¬æœ‰åŠ©äºè®©æ¯ä¸ªäººéƒ½ä½¿ç”¨ç›¸åŒçš„è½¯ä»¶åŒ…ç‰ˆæœ¬ï¼Œä»¥ä¾¿æ•´ä¸ªå›¢é˜Ÿè¿è¡Œç›¸åŒçš„ç‰ˆæœ¬ã€‚

```bash
npm install <package-name>@<version>
# or
yarn add <package-name>@<version>
# or
pnpm add <package-name>@<version>
```

8. è¿è¡Œä»»åŠ¡

package.json æ–‡ä»¶æ”¯æŒä¸€ç§æ ¼å¼ï¼Œç”¨äºæŒ‡å®šå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è¿è¡Œçš„å‘½ä»¤è¡Œä»»åŠ¡

```json
// package.json
{
  "scripts": {
    "watch": "webpack --watch --progress --colors --config webpack.conf.js",
    "dev": "webpack --progress --colors --config webpack.conf.js",
    "prod": "NODE_ENV=production webpack -p --config webpack.conf.js"
  }
}
```

å¯ä»¥é€šè¿‡ npm run <task-name> æ¥ä»£æ›¿é‚£ä¹ˆé•¿ä¸²å‘½ä»¤ã€‚

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
```

9. å®‰è£…å…¨å±€ä¾èµ–

é€šè¿‡ npm root -g æŸ¥çœ‹å…¨å±€å®‰è£…çš„ä½ç½®ã€‚nodemon çš„ä½œç”¨æ˜¯åŠ¨æ€æ›´æ–°æœåŠ¡æ–‡ä»¶ã€‚

```bash
npm install -g nodemon
```

ä¸‰ã€NodeJs å¸¸ç”¨æ¨¡å—

1. Buffer æ¨¡å—

Buffer æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œç”¨æ¥å¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚

Buffer çš„ç‰¹ç‚¹ï¼š1. å¤§å°å›ºå®šæ— æ³•è°ƒæ•´ã€‚2. æ€§èƒ½è¾ƒå¥½ï¼Œå¯ä»¥ç›´æ¥å¯¹è®¡ç®—æœºå†…å­˜è¿›è¡Œæ“ä½œã€‚3. æ¯ä¸ªå…ƒç´ çš„å¤§å°ä¸º 1 å­—èŠ‚ã€‚

1.1 Buffer çš„åˆ›å»º

Buffer ä¸ºå…¨å±€å±æ€§å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œalloc ä»£è¡¨åˆ†é…ï¼Œå¦‚ä¸‹ç»™ buf å˜é‡åˆ†é… 10 ä¸ªå­—èŠ‚ã€‚

```js
let buf = Buffer.alloc(10); // <Buffer 00 00 00 00 00 00 00 00 00 00>
```

allocUnsafe ä»£è¡¨ä¸å®‰å…¨åˆ†é…ï¼Œå’Œä¸Šé¢è¿è¡Œç»“æœä¸€æ ·ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å‹’ï¼Ÿä½¿ç”¨ allocUnsafe åˆ›å»ºçš„æ•°æ®å¯èƒ½ä¼šåŒ…å«æ—§çš„å†…å­˜æ•°æ®ã€‚

```js
let buf = Buffer.allocUnsafe(10); // <Buffer 00 00 00 00 00 00 00 00 00 00>
```

from å¯ä»¥å°†å­—ç¬¦ä¸²ã€æ•°ç»„è½¬æ¢ä¸º bufferï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ä¼šè½¬æ¢ä¸º unicode ç è¡¨ç è¡¨çš„æ•°å­—ï¼Œæ•°å­—è½¬æ¢æˆäºŒè¿›åˆ¶ä¿å­˜åœ¨ç è¡¨ä¸­ã€‚

```js
let buf = Buffer.from("yqcoder"); // <Buffer 79 71 63 6f 64 65 72>
```

1.2 Buffer ä¸å­—ç¬¦ä¸²è½¬æ¢

ä½¿ç”¨ toString() æ–¹æ³•ï¼Œå°† buffer è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

```js
let buf = Buffer.from("yqcoder");
let name = buf.toString(); // yqcoder
```

1.3 Buffer å’Œä¸­æ–‡è½¬æ¢

ä¸­æ–‡è½¬ Bufferï¼Œä¸€ä¸ªæ±‰å­—å  3 ä¸ªå­—èŠ‚

```js
let buf = Buffer.from("ä½ å¥½"); // <Buffer e4 bd a0 e5 a5 bd>
```

1.4 é€šè¿‡ [] æ“ä½œå•ä¸ªå­—ç¬¦

å’Œæ•°ç»„ç±»ä¼¼ï¼Œé€šè¿‡ [] ä¸‹æ ‡çš„æ–¹å¼ï¼Œå®ç°è¯»å–å’Œä¿®æ”¹

```js
let buf = Buffer.from("yqcoder");
buf[0]; // 121
```

2. fs æ¨¡å—

fs å¯ä»¥å’Œæˆ‘ä»¬ç¡¬ç›˜è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚æ–‡ä»¶çš„åˆ›å»ºã€åˆ é™¤ã€é‡å‘½åã€ç§»åŠ¨ã€‚æ–‡ä»¶å†…å®¹çš„å†™å…¥ã€è¯»å–ã€‚å’Œæ–‡ä»¶å¤¹ç›¸å…³æ“ä½œã€‚

æ³¨ï¼šfs ä¸­çš„ç›¸å¯¹è·¯å¾„ç›¸å¯¹çš„æ˜¯æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·çš„ç›®å½•ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•,è¿™å°±å®¹æ˜“å‡ºé—®é¢˜ã€‚ä½¿ç”¨\_\_dirname æ‹¼æ¥ç»å¯¹è·¯å¾„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\_\_dirname è¡¨ç¤ºæ‰§è¡Œæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ã€‚\_\_filename è¡¨ç¤ºæ‰§è¡Œæ–‡ä»¶çš„æ‰€åœ¨è·¯å¾„

2.1 å†™å…¥æ–‡ä»¶

ä½¿ç”¨ fs.writeFile(file, data[, options], callback) åˆ›å»ºå’Œå†™å…¥æ–‡ä»¶ï¼Œfile æ–‡ä»¶åã€data å†™å…¥æ•°æ®ã€options å¯é€‰é…ç½®ã€callback å›è°ƒå‡½æ•°ã€‚

writeFile æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œjs çš„ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå½“æ‰§è¡Œåˆ° writeFile æ—¶ä¼šè¿›è¡Œç£ç›˜çš„å†™å…¥ï¼Œå¹¶å°†ç£ç›˜å†™å…¥æ“ä½œäº¤ç»™ I/O çº¿ç¨‹å»å®Œæˆã€‚I/O çº¿ç¨‹ä¼šåœ¨å†™å…¥å®Œæ¯•åï¼Œå°†å›è°ƒå‡½æ•°æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œåœ¨ä¸»çº¿ç¨‹ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—çš„å‡½æ•°ã€‚è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ã€‚

```js
const fs = require("fs");
fs.writeFile("./demo.txt", "hello yqcoder", (err) => {
  if (err) {
    console.log("å†™å…¥å¤±è´¥");
    return;
  }
  console.log("å†™å…¥æˆåŠŸ!");
});
```

writeFileSync åŒæ­¥æ“ä½œã€‚ä½¿ç”¨å’Œ writeFile å·®ä¸å¤šï¼Œåªæ˜¯æ²¡æœ‰å›è°ƒå‡½æ•°äº†ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œåˆ° writeFileSync æ—¶ï¼Œååœæ­¢æ‰§è¡Œåç»­ä»£ç ï¼Œç­‰ I/O çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå†ç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚å¦‚ä¸‹ä½¿ç”¨ try catch æ˜¯ä¸ºäº†é˜²æ­¢è¯»å†™å¤±è´¥åï¼Œé˜»å¡ç¨‹åºç»§ç»­è¿è¡Œã€‚

```js
const fs = require("fs");
try {
  fs.writeFileSync("./demo.txt", "yqcoder");
} catch (err) {}
```

2.2 è¿½åŠ å†…å®¹

ä½¿ç”¨ fs.appendFile(file, data[, options], callback)ï¼Œå‚æ•°å«ä¹‰åŒ writeFile çš„å‚æ•°ã€‚åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å†…å®¹ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå…ˆåˆ›å»ºæ–‡ä»¶å†æ·»åŠ å†…å®¹ã€‚ä½¿ç”¨ \r\n å®ç°æ·»åŠ æ–‡æœ¬æ¢è¡Œã€‚åŒæ­¥æ“ä½œ fs.appendFileSyncã€‚

```js
const fs = require("fs");
fs.appendFile("./demo.txt", "\r\nyqcoder", (err) => {
  if (err) {
    console.log("å†™å…¥å¤±è´¥");
    return;
  }
  console.log("å†™å…¥æˆåŠŸ!");
});
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ fs.writeFileï¼Œæ·»åŠ é…ç½®ã€‚

```js
const fs = require("fs");
fs.writeFile("./demo.txt", "hello yqcoder", { flag: "a" }, (err) => {
  if (err) {
    console.log("å†™å…¥å¤±è´¥");
    return;
  }
  console.log("å†™å…¥æˆåŠŸ!");
});
```

2.3 æµå¼å†™å…¥

é€šè¿‡ fs.createWriteStream(path[, options]) åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œpath æ–‡ä»¶è·¯å¾„ã€‚options å¯é€‰é…ç½®ã€‚ä½¿ç”¨å®ä¾‹æ–¹æ³• ws.write(data) å¾€ç›®æ ‡æ–‡ä»¶å†™å…¥å†…å®¹ã€‚å’Œ writeFile çš„åŒºåˆ«æ˜¯ writeFile æ˜¯ä¸€æ¬¡æ€§å†™å…¥ï¼ŒcreateWriteStream æ˜¯æ‰“å¼€ä¸€ä¸ªé€šé“ï¼Œåœ¨é€šé“æ²¡æœ‰å…³é—­ä¹‹å‰ï¼Œå¯ä»¥æ–­æ–­ç»­ç»­çš„ç»™æ–‡ä»¶å†™å…¥å†…å®¹ã€‚é€‚åˆå†™å…¥é¢‘ç‡é«˜çš„åœºæ™¯ã€‚

```js
const fs = require("fs");
const ws = fs.createWriteStream("./demo.txt");
ws.write("yqcoder,");
ws.write("hello");
ws.close();
```

2.4 æ–‡ä»¶è¯»å–

ä½¿ç”¨ fs.readFile(path[, options], callback) è¯»å–æ–‡ä»¶ï¼Œpath æ–‡ä»¶è·¯å¾„ï¼Œoptions å¯é€‰é…ç½®ï¼Œcallback å›è°ƒå‡½æ•°ã€‚readFileSync(path[, options])åŒæ­¥è¯»å–ã€‚

```js
const fs = require("fs");
fs.readFile("./demo.txt", (err, data) => {
  if (err) {
    console.log("è¯»å–å¤±è´¥");
    return;
  }
  console.log(data); // <Buffer 79 71 63 6f 64 65 72 2c 68 65 6c 6c 6f>
  console.log(data.toString()); // yqcoder,hello
});
```

2.5 æµå¼è¯»å–

é€šè¿‡ fs.createReadStream(path[, options]) åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œpath æ–‡ä»¶è·¯å¾„ã€‚options å¯é€‰é…ç½®ã€‚ç›‘å¬ data äº‹ä»¶ ï¼Œws.on('data', (chunk) => {}) æ¯æ¬¡è·å– 64kb çš„æ–‡ä»¶å†…å®¹ chunkã€‚è¯»å–å®Œæˆåï¼Œè§¦å‘ end äº‹ä»¶ã€‚å’Œ readFile çš„åŒºåˆ«æ˜¯ readFile æ˜¯ä¸€æ¬¡æ€§è¯»å–ï¼ŒcreateReadStream æ˜¯æµå¤±è¯»å–ï¼Œèƒ½æå‡è¯»å–å¤§æ–‡ä»¶æ•ˆç‡ã€‚

```js
const fs = require("fs");
const rs = fs.createReadStream("./demo.txt");
rs.on("data", (chunk) => {
  console.log(chunk.length);
});
rs.on("end", () => {
  console.log("è¯»å–å®Œæˆ");
});
```

2.6 é‡å‘½åå’Œç§»åŠ¨

ä½¿ç”¨ fs.rename(oldPath, newPath, callback) é‡å‘½åæ–‡ä»¶ï¼Œoldpath å°±æ–‡ä»¶åœ°å€ï¼ŒnewPath æ–°æ–‡ä»¶åœ°å€ï¼Œcallback å›è°ƒå‡½æ•°ã€‚renameSync(oldPath, newPath)åŒæ­¥å‘½åã€‚

ä½¿ç”¨é‡å‘½å API å¯ä»¥å®ç°æ–‡ä»¶ç§»åŠ¨çš„æ•ˆæœã€‚

```js
const fs = require("fs");
fs.rename("./demo.jpg", "./newDemo.jpg", (err) => {
  if (err) {
    console.log("é‡å‘½åå¤±è´¥");
    return;
  }
  console.log("é‡å‘½åæˆåŠŸ");
});
```

2.7 æ–‡ä»¶åˆ é™¤

ä½¿ç”¨ fs.unlink(path, callbck) åˆ é™¤æ–‡ä»¶ï¼Œpath æ–‡ä»¶è·¯å¾„ï¼Œcallback å›è°ƒå‡½æ•°ã€‚unlinkSync(path) åŒæ­¥åˆ é™¤ã€‚

ä¹Ÿå¯ä»¥ä½¿ç”¨ fs.rm(path, callbck) åˆ é™¤æ–‡ä»¶ï¼Œpath æ–‡ä»¶è·¯å¾„ï¼Œcallback å›è°ƒå‡½æ•°ã€‚rmkSync(path) åŒæ­¥åˆ é™¤ã€‚

```js
const fs = require("fs");

fs.unlink("./newDemo.jpg", (err) => {
  if (err) {
    console.log("åˆ é™¤å¤±è´¥");
    return;
  }
  console.log("åˆ é™¤æˆåŠŸ");
});
// or
fs.rm("./newDemo.jpg", (err) => {
  if (err) {
    console.log("åˆ é™¤å¤±è´¥");
    return;
  }
  console.log("åˆ é™¤æˆåŠŸ");
});
```

2.8 æ–‡ä»¶å¤¹æ“ä½œ

2.8.1 åˆ›å»º

ä½¿ç”¨ fs.mkdir(path[, options], callback) åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œpath æ–‡ä»¶å¤¹è·¯å¾„ï¼Œoptions å¯é€‰é…ç½®ï¼Œcallback å›è°ƒå‡½æ•°ã€‚mkdirSync(path[, options]) åŒæ­¥åˆ›å»ºã€‚

```js
const fs = require("fs");
fs.mkdir("./demo", (err) => {
  if (err) {
    console.log("åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥");
    return;
  }
  console.log("åˆ›å»ºæ–‡ä»¶å¤¹æˆåŠŸ");
});
```

é€’å½’åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œéœ€è¦æ·»åŠ é…ç½® { recursive: true }

```js
const fs = require("fs");
fs.mkdir("./demo/assets/img", { recursive: true }, (err) => {
  if (err) {
    console.log("åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥");
    return;
  }
  console.log("åˆ›å»ºæ–‡ä»¶å¤¹æˆåŠŸ");
});
```

2.8.2 è¯»å–

ä½¿ç”¨ readdir(path[, options], callback) è¯»å–æ–‡ä»¶å¤¹æœ‰å“ªäº›æ–‡ä»¶ï¼Œpath æ–‡ä»¶å¤¹è·¯å¾„ï¼Œoptions å¯é€‰é…ç½®ï¼Œcallback å›è°ƒå‡½æ•°ã€‚readdirSync(path[, options]) åŒæ­¥è¯»å–ã€‚

```js
const fs = require("fs");
fs.readdir("./demo", (err, data) => {
  if (err) {
    console.log("è¯»å–æ–‡ä»¶å¤¹å¤±è´¥");
    return;
  }
  console.log("è¯»å–æ–‡ä»¶å¤¹æˆåŠŸ", data); // è¯»å–æ–‡ä»¶å¤¹æˆåŠŸ [ 'assets' ]
});
```

è¯»å–æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œéœ€è¦æ·»åŠ é…ç½® { recursive: true }

```js
const fs = require("fs");
fs.readdir("./demo", { recursive: true }, (err, data) => {
  if (err) {
    console.log("è¯»å–æ–‡ä»¶å¤¹å¤±è´¥");
    return;
  }
  console.log("è¯»å–æ–‡ä»¶å¤¹æˆåŠŸ", data); // æˆ‘æ²¡æœ‰è¯»å–æˆåŠŸï¼Œå¯èƒ½ node ç‰ˆæœ¬éœ€è¦22ä»¥ä¸Š
});
```

2.8.3 åˆ é™¤

ä½¿ç”¨ fs.rmdir(path[, options], callbck) åˆ é™¤æ–‡ä»¶ï¼Œpath æ–‡ä»¶è·¯å¾„ï¼Œoptions å¯é€‰é…ç½®ï¼Œcallback å›è°ƒå‡½æ•°ã€‚rmdirSync(path[, options]) åŒæ­¥åˆ é™¤ã€‚

æ³¨æ„ï¼šåˆ é™¤çš„æ–‡ä»¶å¤¹ä¸‹ä¸èƒ½æœ‰æ–‡ä»¶ã€‚

```js
const fs = require("fs");

fs.rmdir("./demo", (err) => {
  if (err) {
    console.log("åˆ é™¤å¤±è´¥");
    return;
  }
  console.log("åˆ é™¤æˆåŠŸ");
});
```

é€’å½’åˆ é™¤ï¼Œåˆ é™¤æ–‡ä»¶å¤¹åŒ…æ‹¬æ–‡ä»¶å¤¹æ‰€æœ‰æ–‡ä»¶ã€‚éœ€è¦é…ç½® { recursive: true }

```js
const fs = require("fs");

fs.rmdir("./demo", { recursive: true }, (err) => {
  if (err) {
    console.log("åˆ é™¤å¤±è´¥");
    return;
  }
  console.log("åˆ é™¤æˆåŠŸ");
});
```

2.9 æŸ¥çœ‹èµ„æºçŠ¶æ€

ä½¿ç”¨ fs.stat(path[, options], callbck) æŸ¥çœ‹èµ„æºè¯¦ç»†ä¿¡æ¯ï¼Œpath æ–‡ä»¶è·¯å¾„ï¼Œoptions å¯é€‰é…ç½®ï¼Œcallback å›è°ƒå‡½æ•°ã€‚æŸ¥çœ‹æˆåŠŸåå›è°ƒå‡½æ•°è¿”å›çš„ data æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥åˆ¤æ–­æŸ¥çœ‹æ–‡ä»¶çš„ç±»å‹ï¼Œdata.isFile()ï¼Œdata.isDirectory()ã€‚ rmdirSync(path[, options]) åŒæ­¥æŸ¥çœ‹ã€‚

```js
const fs = require("fs");

fs.stat("./demo.mp4", (err, data) => {
  if (err) {
    console.log("æŸ¥çœ‹å¤±è´¥");
    return;
  }
  console.log("æŸ¥çœ‹æˆåŠŸ", data);
  //  æŸ¥çœ‹æˆåŠŸ Stats {
  //   dev: 3603322110,
  //   mode: 33206,
  //   nlink: 1,
  //   uid: 0,
  //   gid: 0,
  //   rdev: 0,
  //   blksize: 4096,
  //   ino: 844424930382849,
  //   size: 101030174,
  //   blocks: 197328,
  //   atimeMs: 1718876089782.0842,
  //   mtimeMs: 1718876089782.0842,
  //   ctimeMs: 1718876089782.0842,
  //   birthtimeMs: 1718876088481.4133,
  //   atime: 2024-06-20T09:34:49.782Z,
  //   mtime: 2024-06-20T09:34:49.782Z,
  //   ctime: 2024-06-20T09:34:49.782Z,
  //   birthtime: 2024-06-20T09:34:48.481Z
  // }
  console.log(data.isFile()); // true
  console.log(data.isDirectory()); // false
});
```

3. path æ¨¡å—

path æ¨¡å—æ˜¯ç”¨æ¥æ“ä½œè·¯å¾„çš„ã€‚

3.1 æ‹¼æ¥ç»å¯¹è·¯å¾„

ä½¿ç”¨ path.resolve(path[, path]...) æ‹¼æ¥è·¯å¾„ï¼Œpath æ–‡ä»¶è·¯å¾„ï¼Œä½¿ç”¨ \_\_dirname æ‹¿åˆ°å½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œç„¶åæ‹¼æ¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°éœ€è¦æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œè¾“å‡ºç»“æœä¸º\æ‹¼æ¥çš„è·¯å¾„ã€‚

```js
const path = require("path");
path.resolve(__dirname, "./demo.mp4");
// ç­‰äº
path.resolve(__dirname, "demo.mp4");
```

3.2 è·å–æ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦

ä½¿ç”¨ path.sep è·å–æ“ä½œç¬¦ï¼Œä¸åŒæ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦ä¸ä¸€æ ·ï¼Œwindows \ï¼ŒLinux /

```js
const path = require("path");
path.sep; // \
```

3.3 è§£æè·¯å¾„

ä½¿ç”¨ path.parse(path) è§£æè·¯å¾„ï¼Œpath æ–‡ä»¶è·¯å¾„ã€‚å¯ä»¥è§£ææ–‡ä»¶æ‰€åœ¨ç›˜ç¬¦ rootã€æ‰€åœ¨æ–‡ä»¶å¤¹ dirã€æ–‡ä»¶å…¨å baseã€æ‹“å±•ç¬¦ extã€æ–‡ä»¶å name

```js
const path = require("path");
path.parse(__filename);
// {
//   root: 'D:\\',
//   dir: 'D:\\xxx\\xxx\\xxx\\xxx\\dist',
//   base: 'index.js',
//   ext: '.js',
//   name: 'index'
// }
```

3.4 è·å–è·¯å¾„åŸºç¡€åç§°

ä½¿ç”¨ path.basename(path) è·å–æ–‡ä»¶åï¼Œpath æ–‡ä»¶è·¯å¾„ã€‚

```js
const path = require("path");
console.log(__filename); // D:\xxx\xxx\xxx\xxx\dist\index.js
console.log(path.basename(__filename)); // index.js
```

3.5 è·å–è·¯å¾„ç›®å½•å

ä½¿ç”¨ path.dirname(path) è·å–æ–‡ä»¶åï¼Œpath æ–‡ä»¶è·¯å¾„ã€‚

```js
const path = require("path");
console.log(__filename); // D:\gité¡¹ç›®\notes\docs\æ¯æ—¥åšå®¢\dist\index.js
console.log(path.dirname(__filename)); // D:\gité¡¹ç›®\notes\docs\æ¯æ—¥åšå®¢\dist
```

3.6 è·å–è·¯å¾„æ‹“å±•å

ä½¿ç”¨ path.extname(path) è·å–æ–‡ä»¶åï¼Œpath æ–‡ä»¶è·¯å¾„ã€‚

```js
const path = require("path");
console.log(__filename); // D:\gité¡¹ç›®\notes\docs\æ¯æ—¥åšå®¢\dist\index.js
console.log(path.extname(__filename)); // .js
```

4. http æ¨¡å—

4.1 åˆ›å»ºæœåŠ¡å¯¹è±¡

ä½¿ç”¨ http.createServer(callbck) åˆ›å»ºæœåŠ¡å¯¹è±¡ serverï¼Œcallback å›è°ƒå‡½æ•°ã€‚

callback(res, req) æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œres è¯·æ±‚æŠ¥æ–‡ã€req å“åº”æŠ¥æ–‡ã€‚

res.end(content)ï¼šè®¾ç½®å“åº”å†…å®¹ã€‚

res.setHeader(key, value)ï¼šè®¾ç½®å“åº”å¤´

ä½¿ç”¨ server.listen(port, callback) ç›‘å¬ç«¯å£ï¼Œå¯åŠ¨æœåŠ¡ã€‚å½“æœåŠ¡å¯åŠ¨æˆåŠŸæ‰§è¡Œ listen çš„å›è°ƒã€‚å¯åŠ¨æˆåŠŸå 8080 ç«¯å£å°±è¢«æˆ‘ä»¬çš„æœåŠ¡ç»™å äº†ï¼Œä»¥åæœ‰ç¨‹åºè®¿é—®æˆ‘ä»¬ç”µè„‘ 8080 ç«¯å£ï¼Œæˆ‘ä»¬åˆ›å»ºæœåŠ¡çš„å›è°ƒå‡½æ•°å°±ä¼šæ‰§è¡Œã€‚

å½“æˆ‘ä»¬çš„æœåŠ¡æ¥å—åˆ° http è¯·æ±‚æ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚æµè§ˆå™¨å¯ä»¥å‘æˆ‘ä»¬çš„æœåŠ¡å‘é€ http è¯·æ±‚ã€‚

HTTP åè®®é»˜è®¤ç«¯å£ 80ï¼ŒHTTPS åè®®é»˜è®¤ç«¯å£ 443ã€‚

```js
const http = require("http");
const server = http.createServer((req, res) => {
  res.end("hello man");
});
server.listen(80, () => {
  console.log("æœåŠ¡å¯åŠ¨æˆåŠŸ:", "http://127.0.0.1:80");
});
```

4.2 è·å–è¯·æ±‚æŠ¥æ–‡

è·å–è¯·æ±‚æŠ¥æ–‡æ•°æ®ã€‚

req.methodï¼šè¯·æ±‚æ–¹æ³•
req.urlï¼šè¯·æ±‚è·¯å¾„ï¼ŒåªåŒ…å«è·¯å¾„å’ŒæŸ¥è¯¢æ¡ä»¶
req.headersï¼šè¯·æ±‚å¤´
req.httpVersionï¼šè¯·æ±‚ç‰ˆæœ¬
req.on('data', (chunk) => {})ï¼šæµå¼è·å–è¯·æ±‚ä½“
req.on('end', () => {})ï¼šè¯·æ±‚ä½“è·å–å®Œæˆ

ä¸ºä»€ä¹ˆéœ€è¦è·å–åˆ°è¯·æ±‚æŠ¥æ–‡å‹’ï¼Ÿå› ä¸ºæˆ‘ä»¬éœ€è¦æ­£ç¡®è¿”å›è¯·æ±‚çš„æ•°æ®ã€‚

```js
const http = require("http");

const server = http.createServer((req, res) => {
  console.log(req);
  console.log(req.method); // GET
  console.log(req.httpVersion); // 1.1
  console.log(req.url); // /
  console.log(req.headers);
  req.on("data", (chunk) => {
    console.log(chunk);
  });
  req.on("end", () => {
    console.log("è·å–å®Œæ¯•");
  });
  res.end("ok");
});

server.listen(80, () => {
  console.log("æœåŠ¡å¯åŠ¨æˆåŠŸ:", "http://127.0.0.1:80");
});
```

4.3 è·å–è¯·æ±‚ä½“

ä½¿ç”¨ new URL(req.url, 'http://127.0.0.1') æ‹¿åˆ°è¯·æ±‚æŠ¥æ–‡è·¯å¾„ï¼Œpathname è¾“å‡ºè·¯å¾„ï¼ŒsearchParams.get(key) æŸ¥è¯¢å­—ç¬¦ä¸²

```js
// è®¿é—® 127.0.0.1/login?username='yqcoder'&password=111
const http = require("http");

const server = http.createServer((req, res) => {
  const url = new URL(req.url, "http://127.0.0.1");
  console.log(url.pathname); // /login
  console.log(url.searchParams.get("username")); // yqcoder
  res.end("hello");
});

server.listen(80, () => {
  console.log("æœåŠ¡å¯åŠ¨æˆåŠŸ:", "http://127.0.0.1:80");
});
```

4.4 è®¾ç½®å“åº”æŠ¥æ–‡

çŠ¶æ€ç  statusCodeã€çŠ¶æ€æè¿° statusMessageã€å“åº”å¤´ setHeaderã€å“åº”ä½“ write()ã€end()ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨ write é‡Œè®¾ç½®äº†å“åº”ä½“ï¼Œå°±ä¸ä¼šåœ¨ end é‡Œä¼ å€¼äº†ã€‚

```js
const http = require("http");

const server = http.createServer((req, res) => {
  const url = new URL(req.url, "http://127.0.0.1");
  res.statusCode = 200;
  res.statusMessage = "æˆåŠŸ";
  res.setHeader("Content-type", "text/html;charset=utf-8");
  res.write("name");
  res.end("ä½ å¥½");
});

server.listen(80, () => {
  console.log("æœåŠ¡å¯åŠ¨æˆåŠŸ:", "http://127.0.0.1:80");
});
```

4.5 è®¾ç½®å“åº”ä½“

```js
const http = require("http");
const fs = require("fs");

const server = http.createServer((req, res) => {
  res.setHeader("content-type", "text/html;charset=utf-8");
  const html = fs.readFileSync(`${__dirname}/index.html`);
  res.end(html);
});

server.listen(80, () => {
  console.log("æœåŠ¡å¯åŠ¨æˆåŠŸ:", "http://127.0.0.1:80");
});
```

4.6 ç½‘é¡µèµ„æºåŠ è½½åŸºæœ¬è¿‡ç¨‹

è¾“å…¥ç½‘å€æŒ‰å›è½¦åï¼ŒæœåŠ¡å™¨é¦–å…ˆè¿”å› html èµ„æºï¼Œç„¶åæ ¹æ® html ä¸­çš„å¤–éƒ¨é“¾æ¥ï¼Œç»§ç»­è¿”å›ç›¸åº”çš„é™æ€èµ„æºã€‚é™æ€æ–‡ä»¶ä¸€èˆ¬åŒ…æ‹¬ jsã€cssã€å›¾ç‰‡ã€è§†é¢‘ç­‰ã€‚

é™æ€èµ„æºè¯·æ±‚çš„è·¯å¾„ï¼Œæ˜¯å¯åŠ¨æœåŠ¡æ–‡ä»¶æ‰€åœ¨è·¯å¾„çš„ç›¸å¯¹è·¯å¾„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œhtml æ–‡ä»¶å¤–é“¾äº† cssï¼Œjsï¼Œpngï¼Œmp4 ç­‰èµ„æºã€‚å¯åŠ¨æœåŠ¡è·å–è¿™äº›å¤–è”èµ„æºã€‚

æ­å»ºä¸€ä¸ªé™æ€èµ„æºæœåŠ¡

```js
const http = require("http");
const fs = require("fs");

const server = http.createServer((req, res) => {
  res.setHeader("Content-type", "text/html;charset=utf-8");
  const { pathname } = new URL(req.url, "http://127.0.0.1");
  let filename = __dirname + pathname;

  fs.readFile(filename, (err, data) => {
    if (err) {
      res.statusCode = 500;
      res.end("æ–‡ä»¶è¯»å–å¤±è´¥");
      return;
    }
    res.end(data);
  });
});

server.listen(80, () => {
  console.log(`æœåŠ¡å¯åŠ¨æˆåŠŸï¼šhttp://127.0.0.1`);
});
```

4.7 é™æ€èµ„æºç›®å½•å’Œç½‘ç«™æ ¹ç›®å½•

é™æ€èµ„æºå­˜åœ¨çš„æ–‡ä»¶å¤¹ç§°ä¹‹ä¸ºé™æ€èµ„æºç›®å½•ä¹Ÿè¢«ç§°ä¸ºç½‘ç«™æ ¹ç›®å½•ã€‚

5. url æ¨¡å—

å†™æ¥å£æ—¶ï¼Œæµè§ˆå™¨çš„è¯·æ±‚è·¯å¾„å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯å¾ˆé‡è¦çš„ã€‚æ‰€ä»¥éœ€è¦ä½¿ç”¨ url æ¨¡å—å»æå–æˆ‘ä»¬æ‰€éœ€è¦çš„è·¯å¾„ä¿¡æ¯ã€‚

5.1 è§£æè·¯å¾„

ä½¿ç”¨ url.parse(path[, boolean]) è§£æè¯·æ±‚è·¯å¾„ï¼Œpath è¯·æ±‚è·¯å¾„ï¼Œboolean æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯å¦ä»¥å¯¹è±¡å±•ç¤ºã€‚url.parse(path) è¿”å›ä¸€ä¸ªè·¯å¾„å¯¹è±¡ resultã€‚é€šè¿‡ result.pathname è·å–è·¯å¾„ã€‚result.query è·å–æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚

```js
// æµè§ˆå™¨è®¿é—® http://127.0.0.1/admin/login?username=yqcoder&password=111
const http = require("http");
const url = require("url");

const server = http.createServer((req, res) => {
  let result = url.parse(req.url, true);
  console.log(result);
  // Url {
  //   protocol: null,
  //   slashes: null,
  //   auth: null,
  //   host: null,
  //   port: null,
  //   hostname: null,
  //   hash: null,
  //   search: '?username=yqcoder&password=111',
  //   query: [Object: null prototype] { username: 'yqcoder', password: '111' },
  //   pathname: '/admin/login',
  //   path: '/admin/login?username=yqcoder&password=111',
  //   href: '/admin/login?username=yqcoder&password=111'
  // }
  res.end("hello man");
});
server.listen(80, () => {
  console.log("æœåŠ¡å¯åŠ¨æˆåŠŸ:", "http://127.0.0.1:80");
});
```

5.2 ç½‘é¡µ URL ä¸­çš„ç»å¯¹è·¯å¾„

ç»å¯¹è·¯å¾„å¯é æ€§å¼ºï¼Œè€Œä¸”å®¹æ˜“ç†è§£ï¼Œç›´æ¥å‘ç›®æ ‡èµ„æºå‘é€è¯·æ±‚ï¼Œå¤šç”¨äºç½‘ç«™çš„å¤–é“¾ã€‚

ç»å¯¹è·¯å¾„æœ‰ä¸‰ç§å½¢å¼ï¼š1. http://www.baidu.com/demo.png å®Œå…¨ä½“ 2. //www.baidu.com/demo.png ä¸é¡µé¢åè®®æ‹¼æ¥ 3. /demo.png ä¸é¡µé¢åè®®ã€åŸŸåã€ç«¯å£æ‹¼æ¥ã€‚

æˆ‘ä»¬é¡¹ç›®ä¸­é™æ€èµ„æºå¤šç”¨äºç¬¬ä¸‰ç§å½¢å¼ï¼Œè¿™æ ·éƒ¨ç½²åˆ°ä¸åŒçš„åŸŸåï¼Œä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®åˆ°ã€‚

5.3 ç½‘é¡µ URL ä¸­çš„ç›¸å¯¹è·¯å¾„

ç›¸å¯¹äºå½“å‰æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚éœ€è¦ä¸å½“å‰é¡µé¢ URL è¿›è¡Œæ‹¼æ¥ã€‚

ç›¸å¯¹è·¯å¾„æœ‰ä¸‰ç§å½¢å¼ï¼š1. ./css/index.css ç­‰äº css/index.css 2. ../js/index.js 3. ../../assets/demo.png

5.4 ç½‘é¡µä¸­ URL ä½¿ç”¨åœºæ™¯

a æ ‡ç­¾ hrefã€link æ ‡ç­¾ hrefã€script æ ‡ç­¾ srcã€img æ ‡ç­¾çš„ srcã€video audio æ ‡ç­¾çš„ srcã€form æ ‡ç­¾çš„ actionã€AJAX è¯·æ±‚çš„ URL ç­‰ã€‚

5.5 mime ç±»å‹

ç”¨æ¥è¡¨ç¤ºæ–‡æ¡£ã€æ–‡ä»¶ã€æˆ–å­—èŠ‚æµçš„æ€§è´¨å’Œæ ¼å¼ã€‚æ ¼å¼ [type]/[subType]ã€‚

HTTP æœåŠ¡è®¾ç½®å“åº”å¤´ Content-Type æ¥å£°æ˜å“åº”ä½“çš„ MIME ç±»å‹ã€‚MIME ç±»å‹æœ‰ï¼š

```js
html: "text/html";
css: "text/css";
js: "text/javescript";
png: "image/png";
jpg: "image/jpg";
gif: "image/gif";
mp4: "video/mp4";
mp3: "audio/mpeg";
json: "application/json";
```

å¯¹æœªçŸ¥èµ„æºä½¿ç”¨ application/octet-stream ç±»å‹ã€‚æµè§ˆå™¨é‡åˆ°è¯¥ç±»å‹çš„å“åº”æ—¶ï¼Œä¼šå¯¹å“åº”ä½“å†…å®¹è¿›è¡Œç‹¬ç«‹å‚¨å­˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è§çš„ä¸‹è½½æ•ˆæœã€‚

5.6 è§£å†³ä¹±ç é—®é¢˜

ä¸­æ–‡ä¹±ç æ—¶ï¼Œé€šè¿‡è®¾ç½®å“åº”å¤´ Content-Type: 'mime ç±»å‹;charset=utf-8'ã€‚

5.7 GET å’Œ POST åŒºåˆ«

GET è¯·æ±‚æƒ…å†µï¼šåœ°å€æ è¾“å…¥ urlã€a é“¾æ¥ã€linkã€scriptã€videoã€audioã€imgã€form æ ‡ç­¾ method ä¸º getã€ajax ä¸­çš„ get

POST è¯·æ±‚æƒ…å†µï¼šform æ ‡ç­¾ postã€AJAX çš„ post è¯·æ±‚

ä¸»è¦åŒºåˆ«ï¼š

```js
ä½œç”¨ï¼šGETç”¨äºè·å–æ•°æ®ã€POST ç”¨äºæäº¤æ•°æ®
å‚æ•°ä½ç½®ï¼šGETè¯·æ±‚æ˜¯ä¸€èˆ¬å°†å‚æ•°ç¼€åˆ° URL ä¹‹åã€POST è¯·æ±‚ä¸€èˆ¬æ˜¯å°†å‚æ•°æ”¾åˆ°è¯·æ±‚ä½“ä¸­
å®‰å…¨æ€§ï¼šPOSTç›¸è¾ƒäºGETå®‰å…¨ä¸€äº›ã€‚
å¤§å°é™åˆ¶ï¼šGET ä¼ å‚ä¸€èˆ¬æ˜¯2Kã€POST ä¼ å‚æ²¡é™åˆ¶
```

å››ã€Express æ¡†æ¶

express æ˜¯ä¸€ä¸ªå°è£…å¥½çš„å¼€å‘æ¡†æ¶ï¼Œå°è£…äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä¾¿äºæˆ‘ä»¬å¼€å‘ WEB åº”ç”¨ã€‚

1. express åˆä½“éªŒ

å®‰è£…ä¾èµ–

```bash
npm install express
```

æ„å»º server.js

```js
const express = require("express");
const app = express();

app.get("/home", (req, res) => {
  res.end("hello express");
});

app.listen(3000, () => {
  console.log("æœåŠ¡å¯åŠ¨æˆåŠŸ.....");
});
```

2. è·¯ç”±ä»‹ç»

è·¯ç”±ç¡®å®šäº†å®¢æˆ·ç«¯å¯¹ç‰¹å®šç«¯ç‚¹çš„è¯·æ±‚ï¼Œè·¯ç”±æ„æˆ app.<method>(path, callback)ï¼Œè¯·æ±‚æ–¹æ³•ã€è·¯å¾„ã€å›è°ƒå‡½æ•°ã€‚

```js
app.get("/home", (req, res) => {
  res.end("hello");
});
```

3. è·¯ç”±çš„ä½¿ç”¨

åŒ¹é… get è¯·æ±‚

```js
app.get("/info", (req, res) => {});
```

åŒ¹é… post è¯·æ±‚

```js
app.post("/login", (req, res) => {});
```

åŒ¹é… get/post è¯·æ±‚ã€‚

```js
app.all("/login", (req, res) => {});
```

åŒ¹é…æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºå“åº” 404 é¡µé¢

```js
app.all("*", (req, res) => {});
```

4. è·å–è¯·æ±‚æŠ¥æ–‡

express å°è£…äº†ä¸€äº› API å¿«é€Ÿè·å–è¯·æ±‚æŠ¥æ–‡ï¼Œreq.path è·¯å¾„ã€req.query è¯·æ±‚å‚æ•°ã€req.ip å®¢æˆ·ç«¯ ip

```js
// ä¾‹å­ /login?username=yqcoder&password=111
app.post("/login", (req, res) => {
  req.path; // /login
  req.query; // { username: 'yqcoder', password: '111' }
  req.ip; // 127.0.0.1
});
```

5. è·å–è·¯ç”±å‚æ•°

ç±»ä¼¼äº¬ä¸œè¯¦æƒ…é¡µ 10086.tmlã€10011.html ç­‰ï¼Œæˆ‘ä»¬ä½¿ç”¨å ä½ç¬¦ id å»åŒ¹é…è¿™ç§å®¢æˆ·ç«¯è¯·æ±‚ã€‚é€šè¿‡ req.params.id æ‹¿åˆ°ã€‚

```js
app.get("/:id.html", (req, res) => {
  // è·å– URL è·¯ç”±å‚æ•°
  req.params.id; //
  res.end("æˆåŠŸ");
});
```

6. å“åº”è®¾ç½®

express å°è£…äº†ä¸€äº› API å¿«é€Ÿè®¾ç½®å“åº”ï¼Œå¹¶ä¸”å¯ä»¥é“¾å¼è®¾ç½®ã€‚res.status è®¾ç½®çŠ¶æ€ï¼Œres.set è®¾ç½®å“åº”å¤´ï¼Œres.send è®¾ç½®å“åº”ä½“

```js
app.get("/login", (req, res) => {
  res.status(200).set("abc", "123").send("è¿™æ˜¯OK");
});
```

7. å…¶ä»–å“åº”

å¯ä»¥å¯¹ http è¯·æ±‚åšå‡ºå…¶ä»–å“åº”ã€‚redirect é‡å®šå‘ï¼Œdownload ä¸‹è½½å“åº”ï¼Œjson å“åº” jsonï¼ŒsendFile å“åº”æ–‡ä»¶å†…å®¹

```js
app.get("/login", (req, res) => {
  // é‡å®šå‘;
  res.rediect("http://www.baidu.com");
  // ä¸‹è½½å“åº”
  res.download(__dirname + "/demo.mp4");
  // JSON å“åº”
  res.json({
    name: "yqcoder",
    slogan: "yyyyy",
  });
  // å“åº”æ–‡ä»¶å†…å®¹
  res.sendFile(__dirname + "/test.html");
});
```

8. ä¸­é—´ä»¶

8.1 ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶

ä¸­é—´ä»¶æœ¬è´¨æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¯ä»¥åƒè·¯ç”±å›è°ƒä¸€æ ·è®¿é—®è¯·æ±‚å¯¹è±¡(req)ã€å“åº”å¯¹è±¡(res)

8.2 ä¸­é—´ä»¶çš„ä½œç”¨

å°è£…å…¬å…±æ“ä½œï¼Œç®€åŒ–ä»£ç 

8.3 ä¸­é—´ä»¶çš„ç±»å‹

ä¸­é—´ä»¶ç±»å‹åˆ†ä¸ºï¼šå…¨å±€ä¸­é—´ä»¶ã€è·¯ç”±ä¸­é—´ä»¶ã€é™æ€èµ„æºä¸­é—´ä»¶

å…¨å±€ä¸­é—´ä»¶ï¼šå¯¹æ‰€æœ‰è¯·æ±‚åšå¤„ç†

```js
function recordMiddleware(req, res, next) {
  let { ip, url } = req;
  console.log(ip, url);
  next();
}

app.use(recordMiddleware);
```

è·¯ç”±ä¸­é—´ä»¶ï¼šåªå¯¹ç‰¹å®šè·¯ç”±åšå¤„ç†

```js
function checkCodeMiddleware(req, res, next) {
  if (req.query.code === "521") {
    next();
  } else {
    res.send("æ— æƒé™");
  }
}

app.get("/menu", checkCodeMiddleware, (req, res) => {
  res.send("åå°é¦–é¡µ");
});
```

é™æ€èµ„æºä¸­é—´ä»¶ï¼šexpress å†…ç½®çš„ä¸­é—´ä»¶ï¼Œè®¾ç½®é™æ€èµ„æºè¯·æ±‚çš„è·¯å¾„ã€‚

```js
// dirname + '/public' è¿™æ˜¯é™æ€èµ„æºæ–‡ä»¶å¤¹è·¯å¾„
app.use(express.static(__dirname + "/public"));
```

é™æ€èµ„æºä¸­é—´ä»¶æ³¨æ„äº‹é¡¹ï¼š1. index.html ä¸ºé»˜è®¤æ‰“å¼€èµ„æºã€‚2. é™æ€èµ„æºä¸è·¯ç”±åŒæ—¶åŒ¹é…ï¼Œè°å…ˆåŒ¹é…è°å°±å“åº”ã€‚3. è·¯ç”±å“åº”åŠ¨æ€èµ„æºï¼Œé™æ€èµ„æºä¸­é—´ä»¶å“åº”é™æ€èµ„æºã€‚

9. è·å–è¯·æ±‚ä½“

express å¯ä»¥ä½¿ç”¨ body-parser åŒ…å¤„ç†è¯·æ±‚ä½“

9.1 å®‰è£…

```bash
npm install body-parser
# or
yarn add body-parser
# or
pnpm add body-parser
```

9.2 ä½¿ç”¨

è·å–ä¸­é—´ä»¶å‡½æ•°ï¼Œè·¯ç”±å¯¼å…¥ä¸­é—´ä»¶ã€‚urlencoded è§£æ querystring æ ¼å¼è¯·æ±‚ä½“çš„ä¸­é—´ä»¶ã€‚json è§£æ JSON æ ¼å¼è¯·æ±‚ä½“çš„ä¸­é—´ä»¶ã€‚

```js
const express = require("express");
const bodyParser = require("body-parser");
const app = express();

// è§£æ querystring
const urlParser = bodyParser.urlencoded({ extended: false });
// è§£æ JSON
let jsonParser = bodyParser.json();

app.post("/login", urlParser, (req, res) => {
  req.body; // è¯·æ±‚ä½“
  req.body.username; // ç”¨æˆ·å
  req.body.password; // å¯†ç 
});
```

10. é˜²ç›—é“¾

ç¦æ­¢å…¶ä»–è·¨åŸŸç½‘ç«™è®¿é—®æˆ‘ä»¬çš„èµ„æºã€‚è¯·æ±‚å¤´ referer ä¼šæºå¸¦è¯·æ±‚èµ„æºçš„ç½‘å€ã€‚

æˆ‘ä»¬é€šè¿‡åœ¨ä¸­é—´ä»¶ä½¿ç”¨ req.get('referer') æ‹¿åˆ° referer çš„å€¼ï¼Œç„¶åå»åˆ¤æ–­ã€‚

```js
app.use((req, res, next) => {
  let referer = req.get("referer");
  if (referer) {
    let url = new URL(referer);
    let hostname = url.hostname;
    if (hostname !== "ç™½åå•ç½‘å€") {
      res.status(404).send("ä¸ç»™çœ‹");
      return;
    }
  }
  next();
});
```

11. è·¯ç”±æ¨¡å—åŒ–

éšç€ä¸šåŠ¡çš„å¢åŠ ï¼Œä¸å¯èƒ½å°†æ‰€æœ‰è·¯ç”±éƒ½å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œéœ€è¦å°†ä¸åŒåŠŸèƒ½çš„è·¯ç”±æ‹†åˆ†å‡ºå»ï¼Œè¿™å°±æ˜¯è·¯ç”±æ¨¡å—åŒ–ã€‚

ä¾‹å¦‚æˆ‘ä»¬æ‹†åˆ†å‡ºç™»å½•è·¯ç”± login.js

```js
const express = require("express");
// åˆ›å»ºè·¯ç”±å¯¹è±¡
const router = express.Router();

router.post("/login", (req, res) => {});

module.exports = router;
```

åœ¨ app.js ä¸­å¯¼å…¥ login.js

```js
const express = require("express");
const loginRouter = require("./login.js");

const app = express();

app.use(loginRouter);
```

ä¹Ÿå¯ä»¥åœ¨ app.use(è·¯ç”±å‰ç¼€, è·¯ç”±æ¨¡å—)ï¼Œä½¿ç”¨è·¯ç”±å‰ç¼€ã€‚å°±æ˜¯è·¯ç”±æ¨¡å—çš„è·¯ç”±éƒ½ä¼šåŠ ä¸Šè·¯ç”±å‰ç¼€ã€‚

```js
const express = require("express");
const loginRouter = require("./login.js");

const app = express();

app.use("/admin", loginRouter);
```

12. EJS æ¨¡æ¿å¼•æ“

12.1 ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“

æ¨¡æ¿å¼•æ“æ˜¯ç”¨äºåˆ†ç¦»ç”¨æˆ·ç•Œé¢å’Œä¸šåŠ¡æ•°æ®çš„ä¸€ç§æŠ€æœ¯ã€‚å¯ç”¨äºåœ¨åç«¯ç›´æ¥ç”Ÿæˆ html é¡µé¢ï¼Œæµè§ˆå™¨è·å–é¡µé¢ç›´æ¥å±•ç¤ºï¼Œè¿™å°±æ˜¯å‰åç«¯æ²¡åˆ†ç¦»æ—¶å€™çš„å¼€å‘æ¨¡å¼ã€‚

12.1 æ¨¡æ¿å¼•æ“æœ‰ä»€ä¹ˆç”¨

SEO æœç´¢å¼•æ“å¯¹äºåç«¯ç”Ÿæˆçš„ html æœ‰æ›´å¥½çš„æœç´¢æ•ˆæœã€‚ä¸€äº›æ¨å¹¿é¡¹ç›®é¡µé¢ï¼Œå¯¹ SEO æœ‰é«˜è¦æ±‚ï¼Œè¿™æ—¶å°±éœ€è¦æ¨¡æ¿å¼•æ“ï¼Œå»åç«¯ç›´æ¥ç”Ÿæˆ html é¡µé¢ã€‚

12.2 å®‰è£… EJS

```bash
npm install ejs
# or
yarn add ejs
# or
pnpm add ejs
```

12.3 EJS è¯­æ³•

è°ƒç”¨ ejs.render(template, data) æ¸²æŸ“å‡½æ•°ï¼Œtemplate æ¸²æŸ“æ¨¡æ¿ï¼Œdata æ¸²æŸ“æ•°æ®å¯¹è±¡ã€‚

12.3.1 å˜é‡

åœ¨æ¸²æŸ“æ¨¡æ¿ä¸­ä½¿ç”¨ <%= å˜é‡å %> æ¥æ”¶å˜é‡ã€‚

```js
const ejs = require("ejs");

let result = ejs.render("my name is <%= name %>", { name: "yqcoder" });

console.log(result); // my name is yqcoder
```

12.3.2 å¾ªç¯

å¤šç”¨äºåˆ—è¡¨çš„æ¸²æŸ“ï¼Œä½¿ç”¨ <% list.forEach(item => { %> åˆ—è¡¨å†…å®¹ <% }) %> å¾ªç¯æ•°æ®

```js
const ejs = require("ejs");

let result = ejs.render(
  `
  <ul>
    <% list.forEach(item => { %>
    <li><%= item.name %></li>
    <% }) %>
  </ul>
`,
  { list: [{ name: "yqcoder" }, { name: "yy" }] }
);
```

12.3.3 æ¡ä»¶æ¸²æŸ“

ä½¿ç”¨ <% if(æ¡ä»¶) {%> ç»“æœ 1 <% } else { %> ç»“æœ 2 <% } %> åˆ¤æ–­ã€‚

```js
const ejs = require("ejs");

let isMan = true;

let result = ejs.render(
  `
  <% if(isMan) {%>
  <span>i am man</span>
  <% } else { %>
  <span>i am woman</span>
  <% } %>
  `,
  { isMan }
);
```

12.4 åœ¨ express ä¸­ä½¿ç”¨ ejs

åˆ›å»º views æ–‡ä»¶å¤¹å­˜æ”¾æ¨¡æ¿æ–‡ä»¶ï¼Œé€šè¿‡ app.set('view engine', 'ejs') è®¾ç½®æ¨¡æ¿å¼•æ“ï¼Œé€šè¿‡ app.set('views', path.resolve(\_\_dirname, './views')) è®¾ç½®æ¨¡æ¿æ–‡ä»¶å­˜æ”¾ä½ç½®ã€‚é€šè¿‡ res.render(æ¨¡æ¿æ–‡ä»¶å, æ•°æ®) æ¸²æŸ“é¡µé¢å¹¶è¿”å›æµè§ˆå™¨ã€‚

```js
const express = require("express");
const ejs = require("ejs");
const path = require("path");

const app = express();

// è®¾ç½®æ¨¡æ¿å¼•æ“
app.set("view engine", "ejs");
// è®¾ç½®æ¨¡æ¿ä½ç½®
app.set("views", path.resolve(__dirname, "./views"));

let title = "yqcoder";
app.get("/home", (req, res) => {
  res.render("home", { title });
});
```

åˆ›å»º home.ejs æ¨¡æ¿æ–‡ä»¶ï¼Œå¿…é¡»æ˜¯ ejs åç¼€ã€‚ä¸ç„¶è¯»å–ä¸åˆ°ã€‚

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="initial-scale=1.0, user-scalable=no, width=device-width"
    />
    <title>document</title>
    <style>
      body {
        background: #000;
      }
    </style>
  </head>
  <body>
    <h1><%= title %></h1>
    <script></script>
  </body>
</html>
```

äº”ã€express-generator è„šæ‰‹æ¶

å¯ä»¥å¿«é€Ÿæ­å»ºæœåŠ¡ç«¯æ¡†æ¶ã€‚

1. å®‰è£…

å…¨å±€å®‰è£… express-generatorï¼Œé€šè¿‡ express -v æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ

```bash
npm install -g express-generator
```

2. ä½¿ç”¨

é€šè¿‡ express å‘½ä»¤å¿«é€Ÿæ­å»ºæœåŠ¡ç«¯æ¡†æ¶ï¼Œexpress -e æ˜¯åœ¨æ¡†æ¶ä¸­ä½¿ç”¨ ejs æ¨¡æ¿å¼•æ“

```bash
express -e
```

åˆ›å»ºæˆåŠŸåï¼Œå®‰è£…ä¾èµ–

```bash
npm install
```

ä¾èµ–å®‰è£…æˆåŠŸåï¼Œå¯åŠ¨æœåŠ¡

```bash
npm run start
```

å¯åŠ¨æˆåŠŸåï¼Œå»æµè§ˆå™¨è®¿é—® 127.0.0.1:3000ï¼Œå°±å¯ä»¥çœ‹åˆ°é¡µé¢äº†ã€‚

<!-- 1 -->

3. æ–‡ä»¶ä¸Šä¼ 

æœåŠ¡ç«¯ç”Ÿæˆé¡µé¢ï¼Œæ„å»ºä¸¤ä¸ªè·¯ç”±ï¼Œä¸€ä¸ªè·¯ç”±è¿”å›è¡¨å•é¡µé¢ï¼Œä¸€ä¸ªè·¯ç”±å¤„ç†æäº¤æ•°æ®

3.1 é¡µé¢è·¯ç”±

è¿”å›è¡¨å•é¡µé¢è·¯ç”±ï¼Œform ä¸º ejs æ¨¡æ¿ form.ejsã€‚

```js
app.get("/form", (req, res) => {
  res.rend("form");
});
```

3.2 form.ejs

æ„å»º form.ejs æ¨¡æ¿ï¼Œæ–‡ä»¶ä¸Šå‡º form æ ‡ç­¾å¿…é¡»åŠ  enctype="multipart/form-data" å±æ€§

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form action="/form" method="post" enctype="multipart/form-data">
      åå­—ï¼š<input type="text" name="username" /> å¤´åƒï¼š<input
        type="file"
        name="png"
      />
      <button>æäº¤</button>
    </form>
  </body>
</html>
```

3.3 å¤„ç†æ–‡ä»¶æ•°æ®

ä½¿ç”¨ formidable ä¾èµ–å¤„ç†æ–‡ä»¶æ•°æ®è·¯ç”±ï¼Œæ‹¿åˆ°ä¸Šä¼ çš„æ–‡ä»¶ç„¶åä¿å­˜åˆ° public æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚

å®‰è£… formidable ä¾èµ–

```bash
npm install formidable@v2
# or
yarn add formidable@v2
# or
pnpm add formidable@v2
```

åœ¨ express ä½¿ç”¨ formidableã€‚

```js
const formidable = require("formidable");

app.post("/form", (req, res) => {
  const form = formidable({
    multiples: true,
    // è®¾ç½®æ–‡ä»¶ä¿å­˜ç›®å½•
    uploadDir: path.resolve(__dirname, "./public/images"),
    // ä¿å­˜æ–‡ä»¶åç¼€
    keepExtensions: true,
  });

  form.parse(req, (err, fields, files, next) => {
    if (err) {
      next(err);
      return;
    }

    // éæ–‡ä»¶æ•°æ®å¯¹è±¡
    console.log(fields); // { username: 'yqcoder' }

    // æ–‡ä»¶æ•°æ®
    console.log(files);
    // {
    //   png: PersistentFile {
    //     _events: [Object: null prototype] { error: [Function (anonymous)] },
    //     _eventsCount: 1,
    //     _maxListeners: undefined,
    //     lastModifiedDate: 2024-06-25T01:59:25.136Z,
    //     filepath: 'D:\\node ç»ƒä¹ \\public\\images\\af1034ff25dae9a8f38e7ef00.mp4',
    //     newFilename: 'af1034ff25dae9a8f38e7ef00.mp4',
    //     originalFilename: 'video.mp4',
    //     mimetype: 'video/mp4',
    //     hashAlgorithm: false,
    //     size: 101030174,
    //     _writeStream: WriteStream {
    //       fd: 4,
    //       path: 'D:\\node ç»ƒä¹ \\public\\images\\af1034ff25dae9a8f38e7ef00.mp4',
    //       flags: 'w',
    //       mode: 438,
    //       start: undefined,
    //       pos: undefined,
    //       bytesWritten: 101030174,
    //       _writableState: [WritableState],
    //       _events: [Object: null prototype],
    //       _eventsCount: 1,
    //       _maxListeners: undefined,
    //       [Symbol(kFs)]: [Object],
    //       [Symbol(kIsPerformingIO)]: false,
    //       [Symbol(kCapture)]: false
    //     },
    //     hash: null,
    //     [Symbol(kCapture)]: false
    //   }
    // }

    // æ•°æ®åº“ä¿å­˜æ–‡ä»¶è®¿é—® url
    let url = `/images/${files.png.newFilename}`;
    console.log(url); // /images/af1034ff25dae9a8f38e7ef00.mp4

    res.json({ fields, files });
  });
});
```

å…­ã€Mongodb

1. Mongodb ä»‹ç»

åŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ï¼Œä»€ä¹ˆæ˜¯æ•°æ®åº“ï¼Ÿæ•°æ®åº“æ˜¯æŒ‰ç…§æ•°æ®ç»“æ„æ¥ç»„ç»‡ã€å‚¨å­˜ã€ç®¡ç†æ•°æ®çš„åº”ç”¨ç¨‹åºã€‚æ•°æ®åº“çš„ä½œç”¨ï¼Ÿä¸»è¦ç”¨æ¥ç®¡ç†æ•°æ®ï¼Œå¯¹æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥ã€‚æ•°æ®åº“ç‰¹ç‚¹æ˜¯é€Ÿåº¦å¿«ã€æ‰©å±•æ€§å¼ºã€å®‰å…¨æ€§å¼ºã€‚ä¸ºä»€ä¹ˆé€‰æ‹© Mongodbï¼Ÿæ“ä½œè¯­æ³•ä¸ JS ç›¸ä¼¼ï¼Œæ˜“ä¸Šæ‰‹ï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚

2. ä¸‹è½½/å®‰è£…

[ä¸‹è½½ Mongodb](https://www.mongodb.com/try/download/community)ï¼Œé€‰æ‹© 5.0.14 ç‰ˆæœ¬ï¼Œç„¶åé€‰æ‹© windows å¹³å°ï¼Œç„¶åé€‰æ‹© zip å‹ç¼©åŒ…ã€‚

å°†ä¸‹è½½å¥½çš„åŒ…æ”¾åˆ° C:Programs Files ä¸‹ï¼Œç„¶åè§£å‹ã€‚

åœ¨ C ç›˜ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ dataï¼Œåœ¨ data ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ dbã€‚è¿™å°±æ˜¯ mongodb é»˜è®¤å­˜æ”¾æ–‡ä»¶çš„ä½ç½® C:data/dbã€‚åœ¨ mongodb çš„ bin ç›®å½•ä¸‹å¯åŠ¨å‘½ä»¤ï¼Œè¿è¡Œå‘½ä»¤ mongodï¼Œæˆ‘ä»¬å°±æŠŠæ•°æ®åº“æœåŠ¡è·‘èµ·æ¥äº†ã€‚

<!-- 2 -->

åŒæ ·åœ¨ bin ç›®å½•ä¸‹å†å¼€ä¸€ä¸ªå‘½ä»¤ï¼Œè¿è¡Œ mongo ï¼Œè¿™æ—¶æˆ‘ä»¬å°±æŠŠå®¢æˆ·ç«¯é“¾æ¥åˆ°äº†æœåŠ¡ç«¯ï¼Œå¯ä»¥å‘æœåŠ¡ç«¯å‘é€ä¸€äº›è¯·æ±‚äº†ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œä¸ç”¨æ¯æ¬¡éƒ½è¦åœ¨ bin ç›®å½•ä¸‹å»å¯åŠ¨æ•°æ®åº“æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ bin ç›®å½•é…ç½®åˆ°ç¯å¢ƒå˜é‡å»ã€‚

<!-- 3 -->

3. Mongodb æ ¸å¿ƒæ¦‚å¿µ

æœ‰ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼šæ•°æ®åº“ï¼ˆdatabaseï¼‰ã€é›†åˆï¼ˆcollectionï¼‰ã€æ–‡æ¡£ï¼ˆdocumentï¼‰ï¼Œæ•°æ®åº“ç±»ä¼¼ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œé›†åˆç±»ä¼¼ JSON æ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ•°ç»„å±æ€§ï¼Œæ–‡æ¡£ç±»ä¼¼ JSON æ–‡ä»¶ä¸­æ•°ç»„å±æ€§é‡Œé¢çš„å¯¹è±¡ã€‚

3.1 æ•°æ®åº“ï¼ˆdatabseï¼‰

æ•°æ®åº“æ˜¯ä¸€ä¸ªæ•°æ®ä»“åº“ï¼Œæ•°æ®åº“æœåŠ¡ä¸‹å¯ä»¥åˆ›å»ºå¾ˆå¤šæ•°æ®åº“ï¼Œæ•°æ®åº“ä¸­å¯ä»¥åˆ›å»ºå¾ˆå¤šé›†åˆã€‚

3.2 é›†åˆï¼ˆcollectionï¼‰

é›†åˆç±»ä¼¼ JS ä¸­çš„æ•°ç»„ï¼Œé‡Œé¢å¯ä»¥å­˜æ”¾å¾ˆå¤šæ–‡æ¡£ã€‚

3.3 æ–‡æ¡£ï¼ˆdocumentï¼‰

æ–‡æ¡£æ˜¯æ•°æ®åº“ä¸­çš„æœ€å°å•ä½ï¼Œç±»ä¼¼ JS ä¸­çš„å¯¹è±¡ã€‚

4. å®¢æˆ·ç«¯æ“ä½œ

å®¢æˆ·ç«¯æœ‰å“ªäº›æ“ä½œå¯ä»¥è¯·æ±‚æœåŠ¡ç«¯å‹’ï¼Ÿåˆ†ä¸ºæ•°æ®åº“å‘½ä»¤ã€é›†åˆå‘½ä»¤ã€æ–‡æ¡£å‘½ä»¤

4.1 æ•°æ®åº“å‘½ä»¤

ä¸»è¦å°±æ˜¯å¯¹æ•°æ®åº“è¿›è¡Œä¸€äº›æ“ä½œ

4.1.1 show dbs

æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“

<!-- 4 -->

4.1.2 use æ•°æ®åº“å

åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰å°±è‡ªåŠ¨åˆ›å»º

<!-- 5 -->

4.1.3 db

æ˜¾ç¤ºå½“å‰æ‰€åœ¨æ•°æ®åº“

<!-- 6 -->

4.1.4 db.dropDatabase()

åˆ é™¤å½“å‰æ•°æ®åº“

4.2 é›†åˆå‘½ä»¤

ä¸»è¦æ˜¯å¯¹é›†åˆçš„ä¸€äº›æ“ä½œ

4.2.1 db.createCollection('é›†åˆå')

åˆ›å»ºé›†åˆ

4.2.2 show collections

æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é›†åˆ

4.2.3 db.é›†åˆå.drop()

åˆ é™¤æŸä¸ªé›†åˆ

4.2.4 db.é›†åˆå.renameCollection('é›†åˆå')

é‡å‘½åé›†åˆå

4.3 æ–‡æ¡£å‘½ä»¤

ä¸»è¦æ˜¯å¯¹æ–‡æ¡£çš„ä¸€äº›æ“ä½œ

4.3.1 db.é›†åˆå.insert('æ–‡æ¡£å¯¹è±¡')

æ’å…¥æ–‡æ¡£

4.3.2 db.é›†åˆå.find(æŸ¥è¯¢æ¡ä»¶)

æŸ¥è¯¢æ–‡æ¡£

4.3.3 db.é›†åˆå.update(æŸ¥è¯¢æ¡ä»¶, æ–°æ–‡æ¡£)

æ›´æ–°æ–‡æ¡£ï¼Œdb.é›†åˆå.update({name: 'å¼ ä¸‰'}, {$set: {age: 13}})

4.4.4 db.é›†åˆå.remove(æŸ¥è¯¢æ¡ä»¶)

åˆ é™¤æ–‡æ¡£

ä¸ƒã€mongoose åŒ…

ä½¿ç”¨ mongoose å¯ä»¥åœ¨ nodeJs ä¸­æ“ä½œæ•°æ®åº“ã€‚

1. å®‰è£…

```bash
npm install mongoose
# or
yarn add mongoose
# or
pnpm add mongoose
```

2. å¯¼å…¥/è¿æ¥æ•°æ®åº“

è¿æ¥æ•°æ®åº“æ—¶ï¼Œè¦ç¡®ä¿æ•°æ®åº“æœåŠ¡æ˜¯å¯åŠ¨çŠ¶æ€ã€‚

```js
const mongoose = require("mongoose");

// è¿æ¥ mongodb æœåŠ¡ä¸­çš„ books æ•°æ®åº“ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º
mongoose.connect("mongodb://127.0.0.1:27017/books");
```

2.1 æˆåŠŸå›è°ƒ

è¿æ¥æˆåŠŸåï¼Œåœ¨é‡Œé¢åšçš„ä¸€äº›æ“ä½œï¼Œå®˜ç½‘æ¨èä½¿ç”¨ once è€Œä¸æ˜¯ onï¼Œå°±æ˜¯åªåšä¸€æ¬¡ç›‘å¬ã€‚å¦‚æœæ˜¯è¿æ¥æ–­å¼€åˆé‡æ–°è¿æ¥æ˜¯ä¸ä¼šè§¦å‘è¿™ä¸ªå›è°ƒã€‚

```js
mongoose.connection.once("open", () => {
  console.log("è¿æ¥æˆåŠŸ");
});
```

2.2 å¤±è´¥å›è°ƒ

è®¾ç½®è¿æ¥é”™è¯¯çš„å›è°ƒ

```js
mongoose.connection.on("error", () => {
  console.log("è¿æ¥å¤±è´¥");
});
```

2.3 å…³é—­å›è°ƒ

è®¾ç½®è¿æ¥å…³é—­å›è°ƒ

```js
mongoose.connection.on("close", () => {
  console.log("å…³é—­è¿æ¥");
});
```

2.4 æ–­å¼€è¿æ¥

```js
mongoose.disconnect();
```

3. æ“ä½œè¯­æ³•

3.1 åˆ›å»ºç»“æ„å¯¹è±¡

é€šè¿‡ new mongoose.Scheme(å®šä¹‰å¯¹è±¡[, é…ç½®]) å®šä¹‰æ–‡æ¡£çš„ç»“æ„å¯¹è±¡ã€‚ç”¨æ¥çº¦æŸé›†åˆä¸­æ–‡æ¡£çš„å±æ€§å’Œå±æ€§ç±»å‹ã€‚

```js
const BookScheme = new mongoose.Schema({
  name: String,
  author: String,
  price: Number,
});
```

3.2 åˆ›å»ºæ¨¡å‹å¯¹è±¡

é€šè¿‡ mongoose.model("é›†åˆå", ç»“æ„å¯¹è±¡) åˆ›å»ºæ¨¡å‹å¯¹è±¡ï¼Œå¯¹æ–‡æ¡£æ“ä½œçš„å°è£…å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥å®Œæˆå¯¹æ–‡æ¡£çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œã€‚

```js
const BookModel = mongoose.model("books", BookScheme);
```

3.3 æ–°å¢

é€šè¿‡ BookModel.create(æ–‡æ¡£å¯¹è±¡) æ¨¡å‹å¯¹è±¡çš„æ–¹æ³•ï¼Œæ–°å¢æ–‡æ¡£ã€‚

```js
BookModel.create({
  name: "é‡‘ç“¶æ¢…",
  author: "yqcoder",
  price: 19.9,
});
```

3.4 åˆ é™¤

é€šè¿‡ BookModel.deleteOne(æŸ¥è¯¢æ¡ä»¶)/BookModel.deleteMany(æŸ¥è¯¢æ¡ä»¶) æ¨¡å‹å¯¹è±¡çš„æ–¹æ³•ï¼Œåˆ é™¤æ–‡æ¡£ã€‚

```js
// åˆ é™¤ä¸€ä¸ª
const data = await BookModel.deleteOne({ name: "é‡‘ç“¶æ¢…" });

// æ‰¹é‡åˆ é™¤
const data = await BookModel.deleteMany({ isShow: false });
```

3.5 ä¿®æ”¹

é€šè¿‡ BookModel.updateOne(æŸ¥è¯¢æ¡ä»¶, æ–‡æ¡£å¯¹è±¡)/BookModel.updateMany(æŸ¥è¯¢æ¡ä»¶, æ–‡æ¡£å¯¹è±¡) æ¨¡å‹å¯¹è±¡çš„æ–¹æ³•ï¼Œä¿®æ”¹æ–‡æ¡£ã€‚

```js
// ä¿®æ”¹ä¸€ä¸ª
const data = await BookModel.updateOne({ name: "é‡‘ç“¶æ¢…" }, { isShow: true });

// æ‰¹é‡ä¿®æ”¹
const data = await BookModel.updateMany({ sex: "man" }, { love: "woman" });
```

3.6 æŸ¥æ‰¾

é€šè¿‡ BookModel.findOne(æŸ¥è¯¢æ¡ä»¶)/BookModel.findById(id) æ¨¡å‹å¯¹è±¡çš„æ–¹æ³•ï¼ŒæŸ¥æ‰¾æ–‡æ¡£ã€‚

```js
// æŸ¥æ‰¾ä¸€ä¸ª
const data = await BookModel.findOne({ name: "yqcoder" });

// é€šè¿‡ id æŸ¥æ‰¾
const data = await BookModel.findById(id);

// æ‰¹é‡è·å–
const data = await BookModel.find();
```

3.7 æ¡ä»¶æŸ¥è¯¢

é€šè¿‡è¿ç®—ç¬¦ $lt <, $lte <=, $gt >, $gte >=, $ne !==, $or æˆ–, $and ä¸ã€‚æŸ¥æ‰¾

```js
// ä»·æ ¼å°äº 20
const data = await BookModel.find({ price: { $lt: 20 } });
```

ä½¿ç”¨æ­£åˆ™æŸ¥è¯¢ï¼Œname ä¸­åŒ…å« 'yq' å­—ç¬¦ä¸²çš„æ•°æ®

```js
const data = await BookModel.find({ name: /yq/ });
```

3.8 è¿”å›æŒ‡å®šå±æ€§

é€šè¿‡ select è¿”å›å‰ç«¯ç”¨çš„ä¸Šçš„å­—æ®µ

```js
// åªè¿”å›nameï¼Œauthor
const data = await BookModel.find({}).select({ name: 1, author: 1, _id: 0 });
```

3.9 æ’åº

æŒ‰ price æ­£åºæ’åˆ—è¿”å›ï¼Œ1 æ˜¯æ­£åºï¼Œ-1 æ˜¯å€’åºã€‚

```js
const data = await BookModel.find().sort({ price: 1 }); // æ­£åº
```

3.10 æ•°æ®æˆªå–

é€šè¿‡ skip è·³è¿‡ã€limit é™å®šæ¥åšæ•°æ®æˆªå–

```js
// è·³è¿‡å‰ 10 æ¡æ•°æ®æŸ¥è¯¢
const data = await BookModel.find().skip(10);

// åªæˆªå–æ•°æ®çš„å‰10æ¡
const data = await BookModel.find().limit(10);
```

4. å­—æ®µç±»å‹

mongoose æœ‰ 9 ç§ç±»å‹ï¼šString å­—ç¬¦ä¸²ã€Number æ•°å­—ã€Boolean å¸ƒå°”å€¼ã€Array æ•°ç»„ã€Date æ—¥æœŸã€Buffer Buffer å¯¹è±¡ã€Mixed ä»»æ„ç±»å‹ã€ObjectId å¯¹è±¡ IDã€Decimal128 é«˜ç²¾åº¦æ•°å­—

5. å­—æ®µéªŒè¯

mongoose æœ‰ä¸€äº›å†…ç½®çš„éªŒè¯æ–¹æ³• requiredã€defaultã€enumã€uniqueï¼Œä¸ºä»€ä¹ˆéœ€è¦å­—æ®µéªŒè¯ï¼Ÿå› ä¸ºæ°¸è¿œä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„è¾“å…¥ã€‚

5.1 required

å±æ€§æ˜¯å¦å¿…å¡«

```js
let BookModel = new mongoose.Schema({
  name: {
    type: String,
    require: true,
  },
});
```

5.2 default

å±æ€§çš„é»˜è®¤å€¼ï¼Œå¦‚æœå‰ç«¯æ²¡ä¼ ï¼Œé»˜è®¤å†™å…¥å°±æ˜¯é»˜è®¤å€¼

```js
let BookModel = new mongoose.Schema({
  author: {
    type: String,
    default: "yqcoder",
  },
});
```

5.3 enum

æšä¸¾å€¼ï¼Œä¼ å…¥çš„å€¼å¿…é¡»æ˜¯æšä¸¾å€¼å†…çš„å€¼

```js
let BookModel = new mongoose.Schema({
  price: {
    type: Number,
    enum: [19.9, 199],
  },
});
```

5.4 unique

å”¯ä¸€å€¼ï¼Œå°±æ˜¯è¿™ä¸ªå€¼åœ¨é›†åˆä¸­æ˜¯å”¯ä¸€çš„ä¸å¯é‡å¤çš„ã€‚

```js
let BookModel = new mongoose.Schema({
  key: {
    type: String,
    unique: true,
  },
});
```

å…«ã€moment æ—¥æœŸå¤„ç†

1. å®‰è£…

```bash
npm install moment
# or
yarn add moment
# or
pnpm add moment
```

2. å¯¼å…¥/ä½¿ç”¨

```js
const moment = require("moment");

// è½¬æ¢æ—¥æœŸå¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“
moment("2024-5-20").toDate(); // 2024-05-19T16:00:00.000Z

// ç”Ÿæˆå›ºå®šæ ¼å¼æ—¥æœŸ
moment(new Date()).format("YYYY-MM-DD"); // 2024-06-26
```

ä¹ã€æ¥å£

[å…è´¹æ¥å£è¯•ç”¨](http://free-api.com/doc)

1. ä»€ä¹ˆæ˜¯æ¥å£

å®ç°å‰åç«¯é€šä¿¡ï¼Œæ¥å£ä¸€èˆ¬ç§°ä¸º API æ¥å£ï¼Œåœ¨åç«¯ä¸€ä¸ªæ¥å£å°±æ˜¯ä¸€ä¸ªè·¯ç”±è§„åˆ™ã€‚

2. RESTful API

æœ‰ç¼–å†™è§„åˆ™çš„ APIï¼š1. ä¸èƒ½åœ¨è·¯å¾„ä¸­ä½¿ç”¨åŠ¨è¯ã€‚2. æ“ä½œèµ„æºè¦ä¸è¯·æ±‚æ–¹å¼å¯¹äºã€‚3. è¿”å›çŠ¶æ€ç è¦ä¸è¿”å›ç»“æœå¯¹åº”ã€‚

3. æ¥å£æµ‹è¯•å·¥å…·

æœ‰ apipostã€postmanã€‚æ¨èä½¿ç”¨ apipostã€‚

åã€ä¼šè¯æ§åˆ¶

å°±æ˜¯æƒé™æ§åˆ¶ï¼Œä¸åŒç”¨æˆ·ä¸åŒæ•°æ®ä¸åŒæƒé™ã€‚ä¼šè¯æ§åˆ¶å¯ä»¥é€šè¿‡ cookieã€sessionã€token ä¸‰ç§æ–¹å¼æ§åˆ¶ã€‚

1. cookie

cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°å®¢æˆ·ç«¯çš„ä¸€å°å—æ•°æ®ï¼Œcookie æŒ‰ç…§åŸŸååˆ’åˆ†ä¿å­˜ã€‚é€šè¿‡å“åº”å¤´å‘é€ set-cookie: name=yqcoderï¼Œæµè§ˆå™¨è§£æåˆ° set-cookie å°±ä¼šå°†è¿™ä¸ªå€¼ä¿å­˜åœ¨æœ¬åœ° cookie ä¸Šï¼Œä¸‹æ¬¡è¯·æ±‚å°±ä¼šå¸¦ä¸Šã€‚

ç‰¹ç‚¹ï¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨å°† cookie è®¾ç½®åœ¨è¯·æ±‚å¤´ï¼Œæµè§ˆå™¨å…³é—­æ—¶é”€æ¯ã€‚

1.1 å®‰è£…

```bash
npm install cookie-parser
# or
yarn add cookie-parser
# or
pnpm add cookie-parser
```

1.2 ä½¿ç”¨

1.2.1 è®¾ç½® cookie

```js
// ç™»å½•æˆåŠŸè®¾ç½® cookie
app.post("/login", (req, res) => {
  res.cookie("name", "lisi", { maxAge: 1000 * 60 });
});
```

1.2.2 åˆ é™¤ cookie

```js
app.post("/logout", (req, res) => {
  res.clearCookie("name");
});
```

1.2.3 è¯»å– cookie

```js
app.get("/user", (req, res) => {
  req.cookies; // { name: 'lisi' }
});
```

2. session

session æ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨çš„ä¸€å—æ•°æ®ã€‚

æµç¨‹ï¼šç™»å½•åï¼ŒæœåŠ¡å™¨ä¿å­˜[{ sid: 'xxxx', username: 'lisi', user_id: '1' }]ï¼Œé€šè¿‡è®¾ç½® cookieï¼Œä¿å­˜ sid çš„å€¼ï¼Œä¸‹æ¬¡å‘é€è¯·æ±‚æºå¸¦ cookieï¼Œé€šè¿‡ sid åˆ¤æ–­ç”¨æˆ·èº«ä»½

2.1 å®‰è£…

```bash
npm install express-session connect-mongo
# or
yarn add express-session connect-mongo
# or
pnpm add express-session connect-mongo
```

2.2 ä½¿ç”¨

```js
const session = require("express-session");
const MongoStore = require("connect-mongo");

app.use(
  session({
    name: "sid", // è®¾ç½®cookieçš„name
    secret: "yqcoder", // å‚ä¸åŠ å¯†çš„å­—ç¬¦ä¸²
    saveUninitializad: false, // æ˜¯å¦ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚éƒ½è®¾ç½®cookieç”¨æ¥å‚¨å­˜sessionçš„id
    resave: true, // æ˜¯å¦åœ¨æ¯æ¬¡è¯·æ±‚åé‡æ–°ä¿å­˜session
    store: MongoStore({
      mongoUrl: "mongodb://127.0.0.1:27017/demo", // æ•°æ®åº“è¿æ¥
    }),
    cookie: {
      httpOnly: true, // å¼€å¯åå‰ç«¯æ— æ³•é€šè¿‡jsæ“ä½œ
      maxAge: 1000 * 60, // è¿‡æœŸæ—¶é—´
    },
  })
);
```

TO BE CONTINUE

2.2.1 è®¾ç½® session

```js
app.post("/login", (req, res) => {
  req.session.username = req.body.usernmae;
  req.session.password = req.body.password;
  req.session.uid = "xxxxxxxx";
});
```

2.2.2 è¯»å– session

```js
app.get("/user", (req, res) => {
  req.session.username;
});
```

2.2.3 é”€æ¯ session

```js
app.post("/logout", (req, res) => {
  req.session.destroy(() => {
    console.log("é€€å‡ºæˆåŠŸ");
  });
});
```

3. token

token æ˜¯æœåŠ¡ç«¯ç”Ÿæˆè¿”å›ç»™å®¢æˆ·ç«¯çš„ä¸€ä¸²åŠ å¯†å­—ç¬¦ä¸²ï¼Œtoken ä¸­ä¿å­˜ç€ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨ç§»åŠ¨ç«¯æˆ–å°ç¨‹åºç”¨çš„æ¯”è¾ƒå¤šã€‚

ç‰¹ç‚¹ï¼šæœåŠ¡ç«¯å‹åŠ›æ›´å°ã€ç›¸å¯¹æ›´å®‰å…¨ã€æ‰©å±•æ€§æ›´å¼º

3.1 å®‰è£…

```bash
npm install jsonwebtoken
# or
yarn add jsonwebtoken
# or
pnpm add jsonwebtoken
```

3.2 ä½¿ç”¨

3.2.1 åˆ›å»º token

é€šè¿‡ jwt.sign(ç”¨æˆ·æ•°æ®, åŠ å¯†å­—ç¬¦ä¸², é…ç½®å¯¹è±¡) ä½¿ç”¨

```js
const jwt = require("jsonwebtoken");

app.post("/login", (req, res) => {
  let token = jwt.sign(
    {
      username: "yqcoder",
    },
    "manxxxxx",
    {
      expiresIn: 60, // å•ä½ç§’
    }
  );
});
```

3.2.2 æ ¡éªŒ token

ä½¿ç”¨ jwt.verify(token, åŠ å¯†å­—ç¬¦ä¸², callback)

```js
const jwt = require("jsonwebtoken");

app.get("/list", (req, res) => {
  jwt.verify(res.token, "manxxxxx", (err, data) => {});
});
```

4. cookie å’Œ session çš„åŒºåˆ«

cookieï¼šå­˜æ”¾åœ¨æµè§ˆå™¨ä¸­ï¼Œå®‰å…¨æ€§è¾ƒä½ï¼Œå†…å®¹è¿‡å¤šå½±å“ä¼ è¾“æ•ˆç‡ï¼Œå­˜å‚¨å¤§å°ä¸è¶…è¿‡ 4kã€‚

sessionï¼šå­˜æ”¾åœ¨æœåŠ¡å™¨ä¸­ï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒå¥½ï¼Œä¸å½±å“ä¼ è¾“æ•ˆç‡ï¼Œå­˜å‚¨æ²¡æœ‰é™åˆ¶ã€‚

åã€md5 å•å‘åŠ å¯†

ç”¨æˆ·å¯†ç æ˜æ–‡å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œä¹Ÿä¸ä¸€å®šå®‰å…¨ï¼Œæ‰€ä»¥éœ€è¦ md5 å•å‘åŠ å¯†ã€‚é™¤äº†ç”¨æˆ·ï¼Œè°ä¹Ÿä¸çŸ¥é“å¯†ç æ˜¯å¤šå°‘ï¼Œæ•°æ®åº“ä¹Ÿåªèƒ½çœ‹åˆ°ä¸€å †åŠ å¯†åçš„ä¹±ç ã€‚

1. å®‰è£…

```bash
npm install md5
# or
yarn add md5
# or
pnpm add md5
```

2. ä½¿ç”¨

```js
const md5 = require("md5");

app.post("/login", (req, res) => {
  md5(req.body.password);
});
```
