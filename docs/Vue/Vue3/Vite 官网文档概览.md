# Vite 官网文档概览

一. 指引

1. 为什么选择 Vite

1.1 现实问题

在大型项目中，JS 代码量巨大，包含数千个模块，基于 JS 开发的工具就会遇到瓶颈：1. 启动开发服务慢（几分钟）。2，模块热替换（HMR）需要几秒钟才在浏览器反映出来。极大的影响了开发效率和开发幸福感。Vite 利用生态系统新进展解决上述问题：浏览器开始原生支持 ES 模块。越来越多的 JS 工具使用编译性语言编写。

1.1.1 缓慢的服务器启动

Vite 一开始将应用模块分为依赖和源码，加快了开发服务器启动时间。Vite 使用 esbuild 预构建依赖，esbuild 使用 go 编写，比 JS 编写的打包器预构建依赖块 10-100 倍。Vite 以 原生 ESM 方式提供源码。这实际上是让浏览器接管了打包程序的部分工作：Vite 只需要在浏览器请求源码时进行转换并按需提供源码。根据情景动态导入代码，即只在当前屏幕上实际使用时才会被处理。

1.1.2 缓慢的更新

基于打包器启动时，重建整个包的效率很低。原因显而易见：因为这样更新速度会随着应用体积增长而直线下降。

在 Vite 中，HMR 是在原生 ESM 上执行的。当编辑一个文件时，Vite 只需要精确地使已编辑的模块与其最近的 HMR 边界之间的链失活[1]（大多数时候只是模块本身），使得无论应用大小如何，HMR 始终能保持快速更新。

Vite 同时利用 HTTP 头来加速整个页面的重新加载（再次让浏览器为我们做更多事情）：源码模块的请求会根据 304 Not Modified 进行协商缓存，而依赖模块请求则会通过 Cache-Control: max-age=31536000,immutable 进行强缓存，因此一旦被缓存它们将不需要再次请求。

一旦你体验到 Vite 的神速，你是否愿意再忍受像曾经那样使用打包器开发就要打上一个大大的问号了。

1.2 为什么生产环境仍需打包

尽管原生 ESM 现在得到了广泛支持，但由于嵌套导入会导致额外的网络往返，在生产环境中发布未打包的 ESM 仍然效率低下（即使使用 HTTP/2）。为了在生产环境中获得最佳的加载性能，最好还是将代码进行 tree-shaking、懒加载和 chunk 分割（以获得更好的缓存）。

要确保开发服务器和生产环境构建之间的最优输出和行为一致并不容易。所以 Vite 附带了一套 构建优化 的 构建命令，开箱即用。

1.2.1 为何不用 ESBuild 打包？

Vite 目前的插件 API 与使用 esbuild 作为打包器并不兼容。尽管 esbuild 速度更快，但 Vite 采用了 Rollup 灵活的插件 API 和基础建设，这对 Vite 在生态中的成功起到了重要作用。目前来看，我们认为 Rollup 提供了更好的性能与灵活性方面的权衡。

2. 开始

2.1 总览

Vite（法语意为 "快速的"，发音 /vit/，发音同 "veet"）是一种新型前端构建工具，能够显著提升前端开发体验。它主要由两部分组成：

一个开发服务器，它基于 原生 ES 模块 提供了 丰富的内建功能，如速度快到惊人的 模块热更新（HMR）。

一套构建指令，它使用 Rollup 打包你的代码，并且它是预配置的，可输出用于生产环境的高度优化过的静态资源。

2.2 浏览器支持

在开发阶段，Vite 将 esnext 作为转换目标，因为我们假设使用的是现代浏览器，它支持所有最新的 JavaScript 和 CSS 特性。这样可以防止语法降级，让 Vite 尽可能地接近原始源代码。

对于生产构建，默认情况下 Vite 的目标浏览器支持 原生 ES 模块、原生 ESM 动态导入 和 import.meta。旧版浏览器可以通过官方的 @vitejs/plugin-legacy。查看 构建生产环境 了解更多细节。

2.3 在线试用 Vite

你可以通过 [StackBlitz](https://stackblitz.com/edit/vitejs-vite-heargv?file=index.html&terminal=dev) 在线试用 vite。

2.4 搭建第一个 Vite 项目

兼容性注意：Vite 需要 Node.js 版本 18+，20+。然而，有些模板需要依赖更高的 Node 版本才能正常运行，当你的包管理器发出警告时，请注意升级你的 Node 版本。

2.5 社区模板
2.6 index.html 与项目根目录
2.7 命令行界面
2.8 使用未发布功能
2.9 社区

3. 功能
4. 命令行界面
5. 使用插件
6. 依赖预构建
7. 静态资源处理
8. 构建生产版本
9. 部署静态站点
10. 环境变量与模式
11. 服务端渲染（SSR）
12. 后端集成
13. 比较
14. 故障排除
15. 性能
16. 理念
17. 从 v4 迁移

二. API

1. 插件 API
2. HMR API
3. JS API
4. 配置参考

三. 配置

1. 配置 Vite
2. 共享选项
3. 服务器选择
4. 构建选择
5. 预览选择
6. 依赖优化选择
7. SSR 选择
8. Worker 选择
