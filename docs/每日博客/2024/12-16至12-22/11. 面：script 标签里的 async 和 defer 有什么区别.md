# script 标签里的 async 和 defer 有什么区别

当没有 async 和 defer 这两个属性的时候，浏览器会立刻加载并执行指定的脚本

一、脚本下载和执行顺序

1. async（异步）属性

当`script`标签设置了`async`属性时，浏览器会异步下载脚本文件，下载过程不会阻塞页面的其他资源（如 HTML 解析、其他脚本的下载等）。一旦脚本下载完成，浏览器会立即执行这个脚本，执行过程会阻塞页面的解析。这意味着脚本可能在页面还没有完全解析完之前就执行了，并且多个`async`脚本的执行顺序不确定，取决于它们各自的下载速度。

2. defer（延迟）属性

带有`defer`属性的脚本也会异步下载，同样不会阻塞页面的其他资源下载。但是，`defer`脚本会在整个页面解析完成后，按照它们在文档中的先后顺序依次执行。也就是说，所有`defer`脚本会在`DOMContentLoaded`事件之前执行，且执行顺序和它们在 HTML 文档中的顺序一致。

二、适用场景

1. async 适用场景

适用于那些不依赖于页面 DOM 结构和其他脚本，且可以独立运行的脚本。比如一些统计脚本、广告脚本等，这些脚本的主要目的是收集数据或者展示独立的内容，它们不需要等待页面完全加载或者其他脚本执行完成就可以运行。

2. defer 适用场景

适合那些需要操作页面 DOM 结构或者依赖于其他脚本的脚本。

三、对页面性能的影响

1. async 对性能的影响

从积极的方面看，`async`可以加快脚本的下载，因为它不会被页面解析过程所阻碍，能够利用浏览器的空闲资源进行下载。但是，由于它的执行顺序不确定，可能会导致一些依赖关系比较复杂的脚本出现问题。

2. defer 对性能的影响

`defer`属性在保证脚本能够正确执行的前提下，也不会阻塞页面的解析，从而提高了页面的加载速度。因为它是在页面解析完成后才执行，所以可以确保脚本操作的 DOM 元素已经存在，减少了因 DOM 未加载而导致的错误。同时，按照顺序执行的特点使得脚本之间的依赖关系更容易维护，有利于提高代码的稳定性和可预测性。不过，与`async`相比，`defer`脚本可能会稍微延迟一些需要在页面加载初期就执行的功能，但这种延迟通常是可以接受的，特别是对于那些需要确保正确执行的脚本。
